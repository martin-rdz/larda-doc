

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyLARDA.Transformations &mdash; pyLARDA  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> pyLARDA
          

          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_use.html">How to use larda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datacontainer_and_transformation.html">Data container and transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide_config.html">Guide to config-files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup_remote.html">Setup remote date source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../peakTree.html">peakTree extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spectra.html">SpectraProcessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_overview.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Contributors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyLARDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../pyLARDA.html">pyLARDA</a> &raquo;</li>
        
      <li>pyLARDA.Transformations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyLARDA.Transformations</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>


<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="c1"># import itertools</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="c1"># scientific python imports</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">pyLARDA.VIS_Colormaps</span> <span class="k">as</span> <span class="nn">VIS_Colormaps</span>
<span class="kn">import</span> <span class="nn">pyLARDA.helpers</span> <span class="k">as</span> <span class="nn">h</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="join"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.join">[docs]</a><span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">datadict1</span><span class="p">,</span> <span class="n">datadict2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;join two data containers in time domain</span>
<span class="sd">    </span>
<span class="sd">    when you want to join more than two data containers use reduce as done</span>
<span class="sd">    in the connector</span>

<span class="sd">    they have to be in the correct time order</span>

<span class="sd">    Args:</span>
<span class="sd">        datadict1: left data container</span>
<span class="sd">        datadict2: right data container</span>

<span class="sd">    Returns:</span>
<span class="sd">        merged data container</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> do not match&quot;</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span>
    <span class="n">container_type</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">thisjoint</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;joints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">thisjoint</span><span class="p">]</span> <span class="o">+</span> <span class="n">datadict2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;joints </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;joints&#39;</span><span class="p">]))</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]])</span>
    <span class="k">if</span> <span class="s1">&#39;file_history&#39;</span> <span class="ow">in</span> <span class="n">datadict1</span><span class="p">:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;file_history&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;file_history&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;file_history&#39;</span><span class="p">]])</span>

    <span class="k">if</span> <span class="s1">&#39;plot_varconverter&#39;</span> <span class="ow">in</span> <span class="n">datadict1</span><span class="p">:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;plot_varconverter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;plot_varconverter&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]</span>
    <span class="c1"># print(&#39;datadict1 paraminfo &#39;, datadict1[&#39;paraminfo&#39;])</span>
    <span class="c1"># print(&#39;interp_rg_join&#39; in datadict1[&#39;paraminfo&#39;], &#39;rg&#39; in datadict1, datadict1[&#39;paraminfo&#39;][&#39;interp_rg_join&#39;] == True, datadict1[&#39;paraminfo&#39;][&#39;interp_rg_join&#39;] in [&quot;True&quot;, &quot;true&quot;])</span>
    <span class="k">if</span> <span class="s1">&#39;interp_rg_join&#39;</span> <span class="ow">in</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]</span> \
            <span class="ow">and</span> <span class="s1">&#39;rg&#39;</span> <span class="ow">in</span> <span class="n">datadict1</span> \
            <span class="ow">and</span> <span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;interp_rg_join&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> \
                 <span class="ow">or</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;interp_rg_join&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">]):</span>
        <span class="c1"># experimental feature to interpolate the rg variable of the second</span>
        <span class="c1"># data container</span>
        <span class="c1"># print(&#39;inside funct&#39;, datadict1[&#39;rg&#39;].shape, datadict2[&#39;rg&#39;].shape, np.allclose(datadict1[&#39;rg&#39;], datadict2[&#39;rg&#39;]))</span>
        <span class="k">if</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;interp_rg_join set for </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
            <span class="n">datadict2</span> <span class="o">=</span> <span class="n">interpolate2d</span><span class="p">(</span><span class="n">datadict2</span><span class="p">,</span> <span class="n">new_range</span><span class="o">=</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ranges of </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> have been interpolated. (&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;aux&#39;</span><span class="p">]</span> \
            <span class="ow">and</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> \
            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># catch the case, when limrad loads differnet ranges</span>
        <span class="n">size_left</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">size_right</span> <span class="o">=</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">size_left</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># the left array is larger =&gt; expand the right one</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">size_left</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">size_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="p">),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="p">),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">size_left</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">size_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># the right array is larger =&gt; expand the left one</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">size_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">size_left</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dim_to_pad</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_left</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="p">))</span>
            <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">dim_to_pad</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">dim_to_pad</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;needed to modify aux val </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datadict2</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                               <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">],</span> <span class="n">size_left</span><span class="p">,</span> <span class="n">size_right</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;colormap&#39;</span> <span class="ow">in</span> <span class="n">datadict1</span> <span class="ow">or</span> <span class="s1">&#39;colormap&#39;</span> <span class="ow">in</span> <span class="n">datadict2</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">],</span> <span class="s2">&quot;colormaps not equal </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">],</span>
                                                                                                  <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">])</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;vel&#39;</span> <span class="ow">in</span> <span class="n">container_type</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]),</span> <span class="s2">&quot;vel coordinate arrays not equal&quot;</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;var_definition&#39;</span> <span class="ow">in</span> <span class="n">datadict1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_definition&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var_definition&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;var_definition </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_definition&#39;</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var_definition&#39;</span><span class="p">])))</span>
        <span class="c1"># assert np.all(datadict1[&#39;var_definition&#39;] == datadict2[&#39;var_definition&#39;]), &quot;var_definition arrays not equal&quot;</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var_definition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_definition&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="c1"># assert datadict1[&#39;plot_varconverter&#39;] == datadict2[&#39;plot_varconverter&#39;]</span>
    <span class="c1"># new_data[&#39;plot_varconverter&#39;] = datadict1[&#39;plot_varconverter&#39;]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]))</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]))</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]))</span>
        <span class="c1"># print(new_data[&#39;ts&#39;].shape, new_data[&#39;rg&#39;].shape, new_data[&#39;var&#39;].shape)</span>
    <span class="k">elif</span> <span class="n">container_type</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;aux&#39;</span><span class="p">]:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]))</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]))</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]))</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]))</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">datadict1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">datadict2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">new_data</span></div>


<div class="viewcode-block" id="interpolate1d"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.interpolate1d">[docs]</a><span class="k">def</span> <span class="nf">interpolate1d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask_thres</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;same as interpolate2d but for 1d containers (time or range dimension must be len 1)</span>

<span class="sd">    Args:</span>
<span class="sd">        data: larda data container to be interpolated in its 1d-dimension</span>
<span class="sd">        **kwargs:</span>
<span class="sd">        new_time (for interpolation in time dimension) : new time vector to which data should be interpolated</span>
<span class="sd">        new_range (for interpolation in range dimension): new range vector to which data should be interpolated</span>

<span class="sd">    Returns:</span>
<span class="sd">        data_container</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">fill_with</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;wrong data dimension.&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">interp_dim</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interp_dim</span> <span class="o">=</span> <span class="s1">&#39;range&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interp_dim</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">interp_dim</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;new_time&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;have to supply new_time kwarg for interpolation in time&quot;</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;new_time&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">interp_dim</span> <span class="o">==</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;new_range&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;have to supply new_range kwarg for interpolation in rg dimension&quot;</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;new_range&#39;</span><span class="p">]</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">interp_var</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="n">interp_mask</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="n">new_var</span> <span class="o">=</span> <span class="n">interp_var</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
    <span class="c1"># extrapolation is often erroneous</span>
    <span class="n">new_mask</span> <span class="o">=</span> <span class="n">interp_mask</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mask_thres</span>
    <span class="n">interp_data</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">data</span><span class="p">}</span>
    <span class="n">new_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">xnew</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">xnew</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">vector</span><span class="p">)),</span> <span class="n">new_mask</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;ts&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span> <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">xnew</span>
    <span class="k">if</span> <span class="s1">&#39;rg&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span> <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">xnew</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_var</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mask</span>
    <span class="k">return</span> <span class="n">interp_data</span></div>


<div class="viewcode-block" id="interpolate2d"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.interpolate2d">[docs]</a><span class="k">def</span> <span class="nf">interpolate2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask_thres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;interpolate timeheight data container</span>

<span class="sd">    Args:</span>
<span class="sd">        mask_thres (float, optional): threshold for the interpolated mask</span>
<span class="sd">        **new_time (np.array): new time axis</span>
<span class="sd">        **new_range (np.array): new range axis</span>
<span class="sd">        **method (str): if not given, use scipy.interpolate.RectBivariateSpline</span>
<span class="sd">        valid method arguments:</span>
<span class="sd">            &#39;linear&#39; - scipy.interpolate.interp2d</span>
<span class="sd">            &#39;nearest&#39; - scipy.interpolate.NearestNDInterpolator</span>
<span class="sd">            &#39;rectbivar&#39; (default) - scipy.interpolate.RectBivariateSpline</span>

<span class="sd">    Returns:</span>
<span class="sd">        data_container</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># var = h.fill_with(data[&#39;var&#39;], data[&#39;mask&#39;], data[&#39;var&#39;][~data[&#39;mask&#39;]].min())</span>
    <span class="c1"># logger.debug(&#39;var min {}&#39;.format(data[&#39;var&#39;][~data[&#39;mask&#39;]].min()))</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;method&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;rectbivar&#39;</span>
    <span class="n">args_to_pass</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;rectbivar&#39;</span><span class="p">:</span>
        <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="n">interp_var</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">var</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="n">ky</span><span class="p">)</span>
        <span class="n">interp_mask</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span> <span class="n">kx</span><span class="o">=</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="n">ky</span><span class="p">)</span>
        <span class="n">args_to_pass</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;linear1d&#39;</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])))))</span>
        <span class="n">interp_var</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mf">999.0</span><span class="p">)</span>
        <span class="n">interp_mask</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])),</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])),</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">nanmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">interp_var</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">nanmask</span><span class="p">],</span> <span class="n">rg</span><span class="p">[</span><span class="n">nanmask</span><span class="p">],</span> <span class="n">var</span><span class="p">[</span><span class="n">nanmask</span><span class="p">])</span>
        <span class="n">interp_mask</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])))))</span>
        <span class="n">interp_var</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">NearestNDInterpolator</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">interp_mask</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">NearestNDInterpolator</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown Interpolation Method&#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

    <span class="n">new_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;new_time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;new_time&#39;</span><span class="p">]</span>
    <span class="n">new_range</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;new_range&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;new_range&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="s2">&quot;linear1d&quot;</span><span class="p">]:</span>
        <span class="n">new_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">new_time</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_range</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">new_range</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_time</span><span class="p">)))))</span>
        <span class="n">new_var</span> <span class="o">=</span> <span class="n">interp_var</span><span class="p">(</span><span class="n">new_points</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">new_time</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_range</span><span class="p">)))</span>
        <span class="n">new_mask</span> <span class="o">=</span> <span class="n">interp_mask</span><span class="p">(</span><span class="n">new_points</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">new_time</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_range</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_var</span> <span class="o">=</span> <span class="n">interp_var</span><span class="p">(</span><span class="n">new_time</span><span class="p">,</span> <span class="n">new_range</span><span class="p">,</span> <span class="o">**</span><span class="n">args_to_pass</span><span class="p">)</span>
        <span class="n">new_mask</span> <span class="o">=</span> <span class="n">interp_mask</span><span class="p">(</span><span class="n">new_time</span><span class="p">,</span> <span class="n">new_range</span><span class="p">,</span> <span class="o">**</span><span class="n">args_to_pass</span><span class="p">)</span>

    <span class="c1"># print(&#39;new_mask&#39;, new_mask)</span>
    <span class="n">new_mask</span><span class="p">[</span><span class="n">new_mask</span> <span class="o">&gt;</span> <span class="n">mask_thres</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">new_mask</span><span class="p">[</span><span class="n">new_mask</span> <span class="o">&lt;</span> <span class="n">mask_thres</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># print(&#39;new_mask&#39;, new_mask)</span>

    <span class="c1"># print(new_var.shape, new_var)</span>
    <span class="c1"># deepcopy to keep data immutable</span>
    <span class="n">interp_data</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">data</span><span class="p">}</span>

    <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_time</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_range</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_var</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s2">&quot;linear1d&quot;</span><span class="p">,</span> <span class="s1">&#39;rectbivar&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">new_var</span><span class="p">)</span>
    <span class="n">interp_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mask</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s2">&quot;linear1d&quot;</span><span class="p">,</span> <span class="s1">&#39;rectbivar&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">new_mask</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;interpolated shape: time </span><span class="si">{}</span><span class="s2"> range </span><span class="si">{}</span><span class="s2"> var </span><span class="si">{}</span><span class="s2"> mask </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">new_range</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">new_var</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">new_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">interp_data</span></div>


<div class="viewcode-block" id="combine"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.combine">[docs]</a><span class="k">def</span> <span class="nf">combine</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">datalist</span><span class="p">,</span> <span class="n">keys_to_update</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;apply a func to the variable</span>

<span class="sd">    Args:</span>
<span class="sd">        func: a function that takes [datacontainer1, datacontainer2, ..]</span>
<span class="sd">            as given input (order as given in datalist) and returns</span>
<span class="sd">            var, mask</span>
<span class="sd">        datalist: list of data containers or single data container</span>
<span class="sd">        keys_to_update: dictionary of keys to update</span>

<span class="sd">    Returns:</span>
<span class="sd">        new data container</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datalist</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;rg&#39;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">datalist</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>

    <span class="c1"># use the first dict as the base</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">{</span><span class="o">**</span><span class="n">datalist</span><span class="p">}</span>
    <span class="n">new_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">keys_to_update</span><span class="p">)</span>

    <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">datalist</span><span class="p">],</span>
            <span class="s1">&#39;paraminfo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">datalist</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">datalist</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
                               <span class="s1">&#39;paraminfo&#39;</span><span class="p">:</span> <span class="n">datalist</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">]}</span>

    <span class="k">return</span> <span class="n">new_data</span></div>


<div class="viewcode-block" id="slice_container"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.slice_container">[docs]</a><span class="k">def</span> <span class="nf">slice_container</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{},</span> <span class="n">index</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;slice a data_container either by values or indices (or combination of both)</span>

<span class="sd">    using on :py:func:`pyLARDA.helpers.argnearest`</span>

<span class="sd">    .. code::</span>

<span class="sd">        slice_container(data, value={&#39;time&#39;: [timestamp1], &#39;range&#39;: [4000, 5000]})</span>
<span class="sd">        # or</span>
<span class="sd">        slice_container(data, value={&#39;time&#39;: [timestamp1, timestamp2], &#39;range&#39;: [4000, 5000]})</span>
<span class="sd">        # or</span>
<span class="sd">        slice_container(data, index={&#39;time&#39;: [10, 20], &#39;range&#39;: [5, 25]})</span>
<span class="sd">        #or</span>
<span class="sd">        slice_container(data, value={&#39;time&#39;: [timestamp1, timestamp2]},</span>
<span class="sd">                              index={&#39;range&#39;: [5, 25]})</span>

<span class="sd">    Args:</span>
<span class="sd">        value (dict): slice by value of coordinate axis</span>
<span class="sd">        index (dict): slice by index of axis</span>

<span class="sd">    Returns:</span>
<span class="sd">        a sliced container</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dim_to_coord_array</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="s1">&#39;rg&#39;</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="s1">&#39;vel&#39;</span><span class="p">}</span>

    <span class="k">if</span> <span class="s2">&quot;dict&quot;</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimlabel&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimlabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># setup slicer</span>
    <span class="n">sliced_data</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">data</span><span class="p">}</span>
    <span class="n">slicer_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">dim_to_coord_array</span><span class="p">[</span><span class="n">dim</span><span class="p">]],</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="n">dim</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">[</span><span class="n">dim_to_coord_array</span><span class="p">[</span><span class="n">dim</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                <span class="s2">&quot;lower bound above data top&quot;</span>
            <span class="n">slicer_dict</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">slicer_dict</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">index</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">index</span><span class="p">[</span><span class="n">dim</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">[</span><span class="n">dim_to_coord_array</span><span class="p">[</span><span class="n">dim</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                <span class="s2">&quot;lower bound above data top&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slicer_dict</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;slicer dict </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slicer_dict</span><span class="p">))</span>
    <span class="n">new_dimlabel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># slice the coordinate arrays</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]:</span>
        <span class="n">coord_name</span> <span class="o">=</span> <span class="n">dim_to_coord_array</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
        <span class="n">sliced_data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">][</span><span class="n">slicer_dict</span><span class="p">[</span><span class="n">dim</span><span class="p">]]</span>
        <span class="c1"># print(dim, sliced_data[coord_name].shape, sliced_data[coord_name])</span>
        <span class="c1"># print(type(sliced_data[coord_name]))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sliced_data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">sliced_data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_dimlabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sliced_data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sliced_data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sliced_data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Error while slicing! Time or range frame to small for slicing!&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;new_dimlabel </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_dimlabel</span><span class="p">))</span>
    <span class="n">sliced_data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dimlabel</span>
    <span class="c1"># actual slicing the variable</span>
    <span class="n">slicer</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">slicer_dict</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]])</span>
    <span class="n">sliced_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="n">slicer</span><span class="p">]</span>
    <span class="n">sliced_data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">slicer</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sliced_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sliced_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;sliced </span><span class="si">{}</span><span class="s1"> to shape </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sliced_data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sliced_data</span></div>


<div class="viewcode-block" id="select_closest"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.select_closest">[docs]</a><span class="k">def</span> <span class="nf">select_closest</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Select closest time steps from larda container to given time steps and replaces original time steps</span>
<span class="sd">    with given ones</span>
<span class="sd">    Useful when plotting flag data, as interpolation does not work with categorical data</span>

<span class="sd">    Args:</span>
<span class="sd">        data: larda container</span>
<span class="sd">        ts (ndarray): array with unix time steps</span>

<span class="sd">    Returns: </span>
<span class="sd">        larda container with time steps closest to the given ones</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">in_ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">ts_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
        <span class="n">id_diff_min</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">in_ts</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># find index of nearest time step to input time step</span>
        <span class="n">ts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_diff_min</span><span class="p">)</span>  <span class="c1"># append index to list</span>
    <span class="n">data_new</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">put_in_container</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="n">ts_list</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">ts_list</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">data_new</span></div>


<div class="viewcode-block" id="plot_timeseries"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_timeseries">[docs]</a><span class="k">def</span> <span class="nf">plot_timeseries</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot a timeseries data container</span>

<span class="sd">   Args:</span>
<span class="sd">       data (dict): data container</span>
<span class="sd">       **time_interval (list dt): constrain plot to this dt</span>
<span class="sd">       **z_converter (string): convert var before plotting</span>
<span class="sd">               use eg &#39;lin2z&#39; or &#39;log&#39;</span>
<span class="sd">       **var_converter (string): alternate name for the z_converter</span>
<span class="sd">       **fig_size (list): size of figure, default is ``[10, 5.7]``</span>
<span class="sd">       **linewidth (float): controls the line width</span>
<span class="sd">       **alpha (float): controls transparency between [0, 1]</span>
<span class="sd">       **label (string, Bool): True, label the data automatically, otherwise use string</span>
<span class="sd">       **time_diff_jumps (length of time difference between time step required so that it is recognized as a &#39;jump&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="s1">&#39;wrong plot function for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;DeprecationWarning: use plot_timeseries2 instead&quot;</span><span class="p">)</span>

    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;label_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">fontweight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_weight&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_weight&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;semibold&#39;</span>

    <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]:</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]:</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">1.5</span>
    <span class="n">al</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="n">time_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_list</span><span class="p">]</span>
    <span class="c1"># this is the last valid index</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;time_diff_jumps&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">td_jumps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_diff_jumps&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">td_jumps</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">jumps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">td_jumps</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">jumps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;jump at </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="c1"># and modify the dt_list</span>
        <span class="n">dt_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
        <span class="c1"># add the fill array</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;varlims </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="c1"># plotkwargs[&#39;norm&#39;] = matplotlib.colors.LogNorm(vmin=vmin, vmax=vmax)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">al</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_str</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;time_interval&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>

    <span class="c1"># ax.set_ylim([height_list[0], height_list[-1]])</span>
    <span class="c1"># ax.set_xlim([dt_list[rect.t_bg], dt_list[rect.t_ed-1]])</span>
    <span class="c1"># ax.set_ylim([range_list[rect.h_bg], range_list[rect.h_ed-1]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [UTC]&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">time_extend</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;time extend </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_extend</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">_set_xticks_and_xlabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">time_extend</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_profile"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_profile">[docs]</a><span class="k">def</span> <span class="nf">plot_profile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot a profile data container</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): data container</span>
<span class="sd">        **range_interval (list): constrain plot to this ranges</span>
<span class="sd">        **z_converter (string): convert var before plotting</span>
<span class="sd">                use eg &#39;lin2z&#39; or &#39;log&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **fig_size (list): size of figure, default is ``[4, 5.7]``</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">],</span> <span class="s1">&#39;wrong plot function for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">])</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># this is the last valid index</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;varlims </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="c1"># plotkwargs[&#39;norm&#39;] = matplotlib.colors.LogNorm(vmin=vmin, vmax=vmax)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;range_interval&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Height [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                   <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_timeheight"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_timeheight">[docs]</a><span class="k">def</span> <span class="nf">plot_timeheight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot a timeheight data container</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): data container</span>
<span class="sd">        **time_interval (list dt): constrain plot to this dt</span>
<span class="sd">        **range_interval (list float): constrain plot to this ranges</span>
<span class="sd">        **z_converter (string): convert var before plotting</span>
<span class="sd">                use eg &#39;lin2z&#39; or &#39;log&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **contour: add a countour</span>
<span class="sd">        **fig_size (list): size of figure, default is ``[10, 5.7]``</span>
<span class="sd">        **zlim (list): set vmin and vmax of color axis</span>
<span class="sd">        **title: True/False or string, True will auto-generate title</span>
<span class="sd">        **rg_converter: True/false, True will convert from &quot;m&quot; to &quot;km&quot;</span>
<span class="sd">        **time_diff_jumps: default is 60</span>
<span class="sd">        **fig: add to an existing figure</span>
<span class="sd">        **ax: add to an existing axis</span>
<span class="sd">        **cbar: removes cbar if False</span>
<span class="sd">        **mask</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;DeprecationWarning: use plot_timeheight2 instead&quot;</span><span class="p">)</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;label_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">fontweight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_weight&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_weight&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;semibold&#39;</span>

    <span class="c1"># check for availability of dimensions in larda container or xarray object</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;coords&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;rg&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;attribute error, check coords ... wrong plot function for </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;mask&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">values</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
        <span class="n">colormap_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;colormap&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">colormap</span>
        <span class="n">rg_unit</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>
        <span class="n">var_unit</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">system</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;wrong plot function for </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimlabel&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">colormap_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>
        <span class="n">rg_unit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>
        <span class="n">var_unit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span>

    <span class="n">time_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">range_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="k">if</span> <span class="s1">&#39;rg_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rg_converter&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">dt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_list</span><span class="p">]</span>

    <span class="c1"># this is the last valid index</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;time_diff_jumps&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">td_jumps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_diff_jumps&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">td_jumps</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">jumps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">td_jumps</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">jumps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;masked jump at </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="c1"># and modify the dt_list</span>
        <span class="n">dt_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
        <span class="c1"># add the fill array</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">range_list</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">)</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>

    <span class="n">fraction_color_bar</span> <span class="o">=</span> <span class="mf">0.13</span>

    <span class="c1"># hack for categorial plots; currently only working for cloudnet classification</span>
    <span class="n">is_classification</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CLASS&#39;</span><span class="p">,</span> <span class="s1">&#39;CLASS_v2&#39;</span><span class="p">,</span> <span class="s1">&#39;detection_status&#39;</span><span class="p">,</span> <span class="s1">&#39;voodoo_classification&#39;</span><span class="p">,</span> <span class="s1">&#39;CLOUDNET_class&#39;</span><span class="p">,</span> <span class="s1">&#39;target_classification&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;voodoo_classification_post&#39;</span><span class="p">,</span> <span class="s1">&#39;voodoo_class_raw_nosmoothing&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">is_classification</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="c1"># make the figure a littlebit wider and</span>
        <span class="c1"># use more space for the colorbar</span>
        <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.25</span>
        <span class="n">fraction_color_bar</span> <span class="o">=</span> <span class="mf">0.23</span>
    <span class="k">elif</span> <span class="s1">&#39;zlim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;varlims </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
    <span class="n">plotkwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">plotkwargs</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;custom colormaps </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">colormap_name</span> <span class="ow">in</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap_name</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">and</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>

    <span class="n">pcmesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[:]),</span>
                           <span class="n">range_list</span><span class="p">[:],</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">var</span><span class="p">[:,</span> <span class="p">:]),</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">plotkwargs</span>
                           <span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;contour&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">]):</span>
        <span class="n">cdata</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">cdata_var</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cdata_var</span> <span class="o">=</span> <span class="n">cdata</span><span class="o">.</span><span class="n">values</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cdata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Contour data empty!&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;rg_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rg_converter&#39;</span><span class="p">]:</span>
            <span class="n">cdata_rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cdata_rg</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>

        <span class="n">dt_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">]:</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">dt_c</span><span class="p">,</span> <span class="n">cdata_rg</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">cdata_var</span><span class="p">),</span>
                              <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">][</span><span class="s1">&#39;levels&#39;</span><span class="p">],</span>
                              <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span>
                              <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">dt_c</span><span class="p">,</span> <span class="n">cdata_rg</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">cdata_var</span><span class="p">),</span>
                              <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f</span><span class="s1">°C&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;time_interval&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;range_interval&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;rg_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rg_converter&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">],</span> <span class="mf">1000.0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">])</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Height [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rg_unit</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;rg_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rg_converter&#39;</span><span class="p">]:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Height [km]&#39;</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [UTC]&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;zlabel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">var_unit</span><span class="p">)</span>

    <span class="n">cbar_flag</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="s1">&#39;cbar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cbar&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">cbar_flag</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcmesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="n">fraction_color_bar</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">z_string</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_classification</span><span class="p">:</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">]</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">))))</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>

        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_classification</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
            <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.25</span>  <span class="c1"># change back to original</span>

    <span class="n">time_extend</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;time extend </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_extend</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">_set_xticks_and_xlabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">time_extend</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">formatted_datetime</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">formatted_datetime</span> <span class="o">=</span> <span class="n">formatted_datetime</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span>
                         <span class="n">formatted_datetime</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_barbs_timeheight"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_barbs_timeheight">[docs]</a><span class="k">def</span> <span class="nf">plot_barbs_timeheight</span><span class="p">(</span><span class="n">u_wind</span><span class="p">,</span> <span class="n">v_wind</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;barb plot for plotting of horizontal wind vector</span>

<span class="sd">    Args:</span>
<span class="sd">        u_wind (dict): u component of horizontal wind, m/s</span>
<span class="sd">        v_wind (dict): v component of horizontal wind, m/s</span>
<span class="sd">        args:</span>
<span class="sd">        *sounding_data: data container (dict) Wyoming radiosounding, m/s</span>

<span class="sd">        **range_interval: range interval to be plotted</span>
<span class="sd">        **fig_size: size of png (default is [10, 5.7])</span>
<span class="sd">        **all_data: True/False, default is False (plot only every third height bin)</span>
<span class="sd">        **z_lim: min/max velocity for plot (default is 0, 25 m/s)</span>
<span class="sd">        **labelsize: size of the axis labels (default 12)</span>
<span class="sd">        **barb_length: length of the barb (default 5)</span>
<span class="sd">        **flip_barb: bool to flip the barb for the SH  (default is false (=NH))</span>
<span class="sd">        **fig: existing matplotlib figure</span>
<span class="sd">        **ax: existing matplotlib axis</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Plotting arguments</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;ax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;all_data&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;all_data&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;labelsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">14</span>
    <span class="n">flip_barb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flip_barb&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;flip_barb&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="n">barb_length</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;barb_length&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;barb_length&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">5</span>
    <span class="n">fraction_color_bar</span> <span class="o">=</span> <span class="mf">0.13</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>
    <span class="n">zlim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;z_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_data</span><span class="p">:</span>
        <span class="c1"># mask 2 out of 3 height indices</span>
        <span class="n">h_max</span> <span class="o">=</span> <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">mask_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">h_max</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">h_max</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]))</span>
        <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span> <span class="n">mask_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">v_wind</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][:,</span> <span class="n">mask_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Arrange a grid for barb plot</span>
    <span class="p">[</span><span class="n">base_height</span><span class="p">,</span> <span class="n">top_height</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;range_interval&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                                                                             <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">dt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_list</span><span class="p">]</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[:]))</span>

    <span class="c1"># Apply mask to variables</span>
    <span class="n">u_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">v_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">v_wind</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">v_wind</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">u_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">u_var</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">u_var</span><span class="p">)</span>
    <span class="n">v_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">v_var</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">v_var</span><span class="p">)</span>

    <span class="c1"># Derive wind speed in knots, 1m/s= 1.943844knots</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_var</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">v_var</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">u_knots</span> <span class="o">=</span> <span class="n">u_var</span> <span class="o">*</span> <span class="mf">1.943844</span>
    <span class="n">v_knots</span> <span class="o">=</span> <span class="n">v_var</span> <span class="o">*</span> <span class="mf">1.943844</span>

    <span class="c1"># start plotting</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">and</span> <span class="n">ax</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;style&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;LIMCUBE&#39;</span><span class="p">:</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cMap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
        <span class="n">cMap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">cMap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cMap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cax0</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">c_bar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">steps</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">c_bar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u_knots</span><span class="p">,</span> <span class="n">v_knots</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">)</span>
        <span class="n">c_bar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">barb_plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u_knots</span><span class="p">,</span> <span class="n">v_knots</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span>
                             <span class="n">sizes</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">emptybarb</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">length</span><span class="o">=</span><span class="n">barb_length</span><span class="p">,</span> <span class="n">flip_barb</span><span class="o">=</span><span class="n">flip_barb</span><span class="p">)</span>

        <span class="n">c_bar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">barb_plot</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="n">fraction_color_bar</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
        <span class="n">c_bar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Advection Speed [m/s]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Formatting axes and ticks</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [UTC]&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">time_extend</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;time extent </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_extend</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">_set_xticks_and_xlabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">time_extend</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">v_wind</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">],</span> <span class="s2">&quot;u_wind and v_wind range units&quot;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Height [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_wind</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">c_bar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">c_bar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># add 10% to plot width to accommodate barbs</span>
    <span class="n">x_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">time_extend</span><span class="p">),</span>
             <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">time_extend</span><span class="p">)]</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_height</span><span class="p">,</span> <span class="n">top_height</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">94</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># Check for sounding data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">sounding_data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">at_x</span><span class="p">,</span> <span class="n">at_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">sounding_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])),</span>
                                     <span class="n">sounding_data</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">])</span>
            <span class="n">u_sounding</span> <span class="o">=</span> <span class="n">sounding_data</span><span class="p">[</span><span class="s1">&#39;u_wind&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.943844</span>
            <span class="n">v_sounding</span> <span class="o">=</span> <span class="n">sounding_data</span><span class="p">[</span><span class="s1">&#39;v_wind&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.943844</span>
            <span class="n">vel_sounding</span> <span class="o">=</span> <span class="n">sounding_data</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span>

            <span class="n">barb_plot</span><span class="o">.</span><span class="n">sounding</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">at_x</span><span class="p">,</span> <span class="n">at_y</span><span class="p">,</span> <span class="n">u_sounding</span><span class="p">,</span> <span class="n">v_sounding</span><span class="p">,</span>
                                          <span class="n">vel_sounding</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span>
                                          <span class="n">sizes</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">emptybarb</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">length</span><span class="o">=</span><span class="n">barb_length</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_scatter"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_scatter">[docs]</a><span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span><span class="n">data_container1</span><span class="p">,</span> <span class="n">data_container2</span><span class="p">,</span> <span class="n">identity_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;scatter plot for variable comparison between two devices or variables</span>

<span class="sd">    Args:</span>
<span class="sd">        data_container1 (dict): container 1st device</span>
<span class="sd">        data_container2 (dict): container 2nd device</span>
<span class="sd">        x_lim (list): limits of var used for x axis</span>
<span class="sd">        y_lim (list): limits of var used for y axis</span>
<span class="sd">        c_lim (list): limits of var used for color axis</span>
<span class="sd">        **identity_line (bool): plot 1:1 line if True</span>
<span class="sd">        **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **custom_offset_lines (float): plot 4 extra lines for given distance</span>
<span class="sd">        **info (bool): print slope, interception point and R^2 value</span>
<span class="sd">        **fig_size (list): size of the figure in inches</span>
<span class="sd">        **font_size (int): default: 15</span>
<span class="sd">        **font_weight (int): default: semibold</span>
<span class="sd">        **colorbar (bool): if True, add a colorbar to the scatterplot</span>
<span class="sd">        **color_by (dict): data container 3rd device</span>
<span class="sd">        **scale (string): &#39;lin&#39; or &#39;log&#39; --&gt; if you get a ValueError from matplotlib.colors</span>
<span class="sd">                          try setting scale to lin, log does not work for negative values!</span>
<span class="sd">        **cmap (string) : colormap</span>
<span class="sd">        **formstring (string): format string to use as key word argument to fig.colorbar, overwrites the default values</span>
<span class="sd">                               for &#39;lin&#39; or &#39;log&#39; scale. E.g. use &quot;%.2f&quot; for displaying two digits</span>
<span class="sd">        **Nbins (int) : number of bins for histograms</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;DeprecationWarning: use plot_scatter2 instead&quot;</span><span class="p">)</span>

    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;label_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">fontweight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_weight&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_weight&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;semibold&#39;</span>

    <span class="n">var1_tmp</span> <span class="o">=</span> <span class="n">data_container1</span>
    <span class="n">var2_tmp</span> <span class="o">=</span> <span class="n">data_container2</span>

    <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">var1_tmp</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">var2_tmp</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">])</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;viridis&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="c1"># convert var from linear unit with any converter given in helpers</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">var1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var1_tmp</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">var2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var2_tmp</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">var1</span> <span class="o">=</span> <span class="n">var1_tmp</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># +4.5</span>
        <span class="n">var2</span> <span class="o">=</span> <span class="n">var2_tmp</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">x_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;x_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var1</span><span class="p">)]</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;y_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var2</span><span class="p">)]</span>
    <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="k">if</span> <span class="s1">&#39;colorbar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Nbins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nbins&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;Nbins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var1</span><span class="p">))</span> <span class="o">/</span>
                                                                    <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span> <span class="o">-</span>
                                                                          <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))))</span>
    <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;var1 </span><span class="si">{</span><span class="n">var1_tmp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">: len is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="si">}</span><span class="s1">, &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;IQR is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span><span class="si">}</span><span class="s1">,&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;max is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="si">}</span><span class="s1">, min is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">Nbins</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="c1"># Freedman-Diaconis rule: h=2×IQR×n−1/3. number of bins is (max−min)/h, where n is the number of observations</span>
    <span class="c1"># https://stats.stackexchange.com/questions/798/calculating-optimal-number-of-bins-in-a-histogram</span>

    <span class="c1"># create histogram plot</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
    <span class="n">H</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">x_lim</span><span class="p">,</span> <span class="n">y_lim</span><span class="p">])</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;color_by&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coloring scatter plot by </span><span class="si">{}</span><span class="s2">...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color_by&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
        <span class="c1"># overwrite H</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">var3</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color_by&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1"># get the bins of the 2d histogram using digitize</span>
        <span class="n">x_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">xedges</span><span class="p">)</span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">yedges</span><span class="p">)</span>
        <span class="c1"># find unique bin combinations = pixels in scatter plot</span>

        <span class="c1"># sort x and y coordinates using lexsort</span>
        <span class="c1"># lexsort sorts by multiple columns, first by y_coords then by x_coords</span>

        <span class="n">newer_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">))</span>
        <span class="n">x_coords</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="n">newer_order</span><span class="p">]</span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">newer_order</span><span class="p">]</span>
        <span class="n">var3</span> <span class="o">=</span> <span class="n">var3</span><span class="p">[</span><span class="n">newer_order</span><span class="p">]</span>
        <span class="n">first_hit_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">y_coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbins</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">first_hit_y</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">first_hit_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x_coords</span><span class="p">[</span><span class="n">first_hit_y</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span><span class="n">first_hit_y</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbins</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
                       <span class="o">+</span> <span class="n">first_hit_y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nbins</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nbins</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nbins</span><span class="p">):</span>
                <span class="n">H</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">var3</span><span class="p">[</span><span class="n">first_hit_x</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]:</span> <span class="n">first_hit_x</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>

    <span class="n">c_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;c_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="mf">10.</span><span class="p">))))]</span>

    <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span><span class="p">:</span>
        <span class="n">formstring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span>
        <span class="n">pcol</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">c_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">c_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formstring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2E</span><span class="s2">&quot;</span>
        <span class="n">pcol</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">c_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">c_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;info&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">,</span> <span class="s1">&#39;slope = </span><span class="si">{:5.3f}</span><span class="se">\n</span><span class="s1">intercept = </span><span class="si">{:5.3f}</span><span class="se">\n</span><span class="s1">R^2 = </span><span class="si">{:5.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># helper lines (1:1), ...</span>
    <span class="k">if</span> <span class="n">identity_line</span><span class="p">:</span> <span class="n">_add_identity</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;custom_offset_lines&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;custom_offset_lines&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;custom_offset_lines&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_lim</span><span class="p">,</span> <span class="n">x_lim</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="c1"># ax.set_xscale(&#39;log&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var1_tmp</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">var1_tmp</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">var1_tmp</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var2_tmp</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">var2_tmp</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">var2_tmp</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

    <span class="k">if</span> <span class="s1">&#39;colorbar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">))</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">formstring</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;formstring&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;formstring&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">formstring</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcol</span><span class="p">,</span> <span class="n">use_gridspec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">extendrect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extendfrac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">formstring</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;color_by&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;median </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color_by&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color_by&#39;</span><span class="p">][</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;frequency of occurrence&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">c_lim</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data_container1</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">+</span>
                         <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data_container1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot; %Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M - &quot;</span><span class="p">)</span> <span class="o">+</span>
                         <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data_container1</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">),</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1"># ax.tick_params(axis=&#39;both&#39;, which=&#39;both&#39;, right=True, top=True)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;colorbar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorbar&#39;</span><span class="p">]:</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_frequency_of_occurrence"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_frequency_of_occurrence">[docs]</a><span class="k">def</span> <span class="nf">plot_frequency_of_occurrence</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Frequency of occurrence diagram of a variable (number of occurrence for each range bin).</span>
<span class="sd">    x-axis is separated into n bins, default value for n = 100.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): container of Ze values</span>
<span class="sd">        **n_bins (integer): number of bins for reflectivity values (x-axis), default 100</span>
<span class="sd">        **x_lim (list): limits of x-axis, default: data[&#39;var_lims&#39;]</span>
<span class="sd">        **y_lim (list): limits of y-axis, default: minimum and maximum of data[&#39;rg&#39;]</span>
<span class="sd">        **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **range_offset (list): range values where chirp shift occurs</span>
<span class="sd">        **sensitivity_limit (np.array): 1-Dim array containing the minimum sensitivity values for each range</span>
<span class="sd">        **title (string): plot title string if given, otherwise not title</span>
<span class="sd">        **legend (bool): prints legend, default True</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_rg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

    <span class="c1"># create a mask for fill_value = -999. because numpy.histogram can&#39;t handle masked values properly</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span>
    <span class="n">var</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">999.0</span>

    <span class="n">n_bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_bins&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;n_bins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">100</span>
    <span class="n">x_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;x_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="n">v_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;v_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;v_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;y_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

    <span class="c1"># create bins of x and y axes</span>
    <span class="n">x_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_bins</span><span class="p">)</span>
    <span class="n">y_bins</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>

    <span class="c1"># initialize array</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_rg</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">irg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rg</span><span class="p">):</span>
        <span class="c1"># check for key word arguments</span>
        <span class="n">nonzeros</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">var</span><span class="p">[:,</span> <span class="n">irg</span><span class="p">])[</span><span class="n">var</span><span class="p">[:,</span> <span class="n">irg</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">999.0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">nonzeros</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">nonzeros</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin2z&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dBZ&#39;</span>

        <span class="n">H</span><span class="p">[:,</span> <span class="n">irg</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">nonzeros</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">x_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># create figure containing the frequency of occurrence of reflectivity over height and the sensitivity limit</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">))</span>
    <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">pcol</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_bins</span><span class="p">,</span> <span class="n">y_bins</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">v_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">v_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;histogram&#39;</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcol</span><span class="p">,</span> <span class="n">use_gridspec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">extendrect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extendfrac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%2d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Frequencies of occurrence of </span><span class="si">{}</span><span class="s2"> values &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;sensitivity_limit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">sens_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sensitivity_limit&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">sens_lim</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">sens_lim</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sens_lim</span><span class="p">,</span> <span class="n">y_bins</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sensitivity limit&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;range_offset&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;range_offset&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_lim</span><span class="p">):</span>
        <span class="n">rg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;range_offset&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_lim</span><span class="p">,</span> <span class="p">[</span><span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;chirp shift&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_lim</span><span class="p">,</span> <span class="p">[</span><span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_foo_general"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_foo_general">[docs]</a><span class="k">def</span> <span class="nf">plot_foo_general</span><span class="p">(</span><span class="n">data_1</span><span class="p">,</span> <span class="n">data_2</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Frequency of occurrence diagram of a variable (number of occurrence binned by another variable).</span>
<span class="sd">    x-axis is separated into n bins, default value for n = 100.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_1 (dict): container of e.g. Ze values</span>
<span class="sd">        data_2 (dict): container of e.g. velocity values</span>
<span class="sd">        **x_bins (integer): number of bins for dataset 2 values (x-axis), default 100</span>
<span class="sd">        **y_bins (integer): number of bins for dataset 1 values (y-axis), default 100</span>
<span class="sd">        **x_lim (list): limits of x-axis, default: data_2[&#39;var_lims&#39;]</span>
<span class="sd">        **y_lim (list): limits of y-axis, default: data_1[&#39;var_lims&#39;]</span>
<span class="sd">        **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **range_offset (list): range values where chirp shift occurs</span>
<span class="sd">        **sensitivity_limit (np.array): 1-Dim array containing the minimum sensitivity values for each range</span>
<span class="sd">        **title (string): plot title string if given, otherwise not title</span>
<span class="sd">        **legend (bool): prints legend, default True</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  Make sure the shapes of the two data sets are identical.</span>
    <span class="k">assert</span> <span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Data sets don&#39;t have the same shape.&quot;</span>

    <span class="c1"># create a mask for fill_value = -999. because numpy.histogram can&#39;t handle masked values properly</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span>
    <span class="n">var</span><span class="p">[</span><span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">999.0</span>

    <span class="n">var_for_binning</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span>
    <span class="n">var_for_binning</span><span class="p">[</span><span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">999.0</span>

    <span class="n">xn_bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_bins&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;x_bins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">100</span>
    <span class="n">yn_bins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_bins&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;y_bins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">100</span>

    <span class="n">x_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;x_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;y_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>

    <span class="c1"># create bins of x and y axes</span>
    <span class="n">x_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xn_bins</span><span class="p">)</span>
    <span class="n">y_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yn_bins</span><span class="p">)</span>

    <span class="c1"># initialize array</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xn_bins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yn_bins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># loop over bins of var_to_bin</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xn_bins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">it</span><span class="p">,</span> <span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">var_for_binning</span> <span class="o">&gt;</span> <span class="n">x_bins</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">var_for_binning</span> <span class="o">&lt;</span> <span class="n">x_bins</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># find index where var_to_bin is in the current bin</span>
        <span class="c1"># extract var for this index and convert it if needed</span>
        <span class="n">nonzeros</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">ir</span><span class="p">])[</span><span class="n">var</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">ir</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">999.0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">nonzeros</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">nonzeros</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin2z&#39;</span><span class="p">:</span> <span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dBZ&#39;</span>

        <span class="n">H</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">nonzeros</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">y_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># create figure containing the frequency of occurrence of var over var_to_bin bins</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">))</span>
    <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">pcol</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_bins</span><span class="p">,</span> <span class="n">y_bins</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;histogram&#39;</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcol</span><span class="p">,</span> <span class="n">use_gridspec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">extendrect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extendfrac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized Frequency of occurrence of </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">data_2</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">data_1</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="_add_identity"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._add_identity">[docs]</a><span class="k">def</span> <span class="nf">_add_identity</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">*</span><span class="n">line_args</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;helper function for the scatter plot</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        axes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">identity</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="o">*</span><span class="n">line_args</span><span class="p">,</span> <span class="o">**</span><span class="n">line_kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="n">low_x</span><span class="p">,</span> <span class="n">high_x</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">low_y</span><span class="p">,</span> <span class="n">high_y</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">low</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">low_x</span><span class="p">,</span> <span class="n">low_y</span><span class="p">)</span>
        <span class="n">high</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">high_x</span><span class="p">,</span> <span class="n">high_y</span><span class="p">)</span>
        <span class="n">identity</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">])</span>

    <span class="n">callback</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;xlim_changed&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;ylim_changed&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span></div>


<div class="viewcode-block" id="plot_spectra"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_spectra">[docs]</a><span class="k">def</span> <span class="nf">plot_spectra</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Finds the closest match to a given point in time and height and plot Doppler spectra.</span>

<span class="sd">        Notes:</span>
<span class="sd">            The user is able to provide sliced containers, e.g.</span>

<span class="sd">            - one spectrum: ``data[&#39;dimlabel&#39;] = [&#39;vel&#39;]``</span>
<span class="sd">            - range spectrogram: ``data[&#39;dimlabel&#39;] = [&#39;range&#39;, &#39;vel&#39;]``</span>
<span class="sd">            - time spectrogram: ``data[&#39;dimlabel&#39;] = [&#39;time, &#39;vel&#39;]``</span>
<span class="sd">            - time-range spectrogram: ``data[&#39;dimlabel&#39;] = [&#39;time, &#39;range&#39;, &#39;vel&#39;]``</span>

<span class="sd">        Args:</span>
<span class="sd">            data (dict): data container</span>
<span class="sd">            *data2 (dict or numpy.ndarray): data container of a second device</span>
<span class="sd">            **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">            **var_converter (string): alternate name for the z_converter</span>
<span class="sd">            **velmin (float): minimum x axis value</span>
<span class="sd">            **velmax (float): maximum x axis value</span>
<span class="sd">            **vmin (float): minimum y axis value</span>
<span class="sd">            **vmax (float): maximum y axis value</span>
<span class="sd">            **save (string): location where to save the pngs</span>
<span class="sd">            **fig_size (list): size of png, default is [10, 5.7]</span>
<span class="sd">            **mean (float): numpy array dimensions (time, height, 2) containing mean noise level for each spectra</span>
<span class="sd">                            in linear units [mm6/m3]</span>
<span class="sd">            **thresh (float): numpy array dimensions (time, height, 2) containing noise threshold for each spectra</span>
<span class="sd">                              in linear units [mm6/m3]</span>
<span class="sd">            **text (Bool): should time/height info be added as text into plot?</span>
<span class="sd">            **title (str or bool)</span>
<span class="sd">            **smooth (bool): if True, regular pyplot plot function is used (default is step)</span>
<span class="sd">            **alpha (float): triggers transparency of the line plot (not the bar plot), 0 &lt;= alpha &lt;= 1</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple with</span>

<span class="sd">            - fig (pyplot figure): contains the figure of the plot</span>
<span class="sd">              (for multiple spectra, the last fig is returned)</span>
<span class="sd">            - ax (pyplot axis): contains the axis of the plot</span>
<span class="sd">              (for multiple spectra, the last ax is returned)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">fsz</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">velocity_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0</span>
    <span class="n">velocity_max</span> <span class="o">=</span> <span class="mf">8.0</span>
    <span class="n">annot</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="n">n_time</span><span class="p">,</span> <span class="n">n_height</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">time</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">reshape_spectra</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">velmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;velmin&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;velmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span> <span class="n">velocity_min</span><span class="p">)</span>
    <span class="n">velmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;velmax&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;velmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span> <span class="n">velocity_max</span><span class="p">)</span>

    <span class="n">smooth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;smooth&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;x-axis varlims </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">velmin</span><span class="p">,</span> <span class="n">velmax</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;y-axis varlims </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin2z&#39;</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">data2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">vel2</span> <span class="o">=</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">time2</span><span class="p">,</span> <span class="n">height2</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">mask2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">reshape_spectra</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin2z&#39;</span><span class="p">:</span>
                <span class="n">var2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var2</span><span class="p">)</span>
            <span class="n">second_data_set</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">second_data_set</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># plot spectra</span>
    <span class="n">ifig</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n_figs</span> <span class="o">=</span> <span class="n">n_time</span> <span class="o">*</span> <span class="n">n_height</span>

    <span class="k">for</span> <span class="n">iTime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iHeight</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_height</span><span class="p">):</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>

            <span class="n">dTime</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">iTime</span><span class="p">])</span>
            <span class="n">rg</span> <span class="o">=</span> <span class="n">height</span><span class="p">[</span><span class="n">iHeight</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">annot</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">,</span>
                        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> UTC  at </span><span class="si">{:.2f}</span><span class="s1"> m (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">rg</span><span class="p">,</span>
                                                          <span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">smooth</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">var</span><span class="p">[</span><span class="n">iTime</span><span class="p">,</span> <span class="n">iHeight</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">var</span><span class="p">[</span><span class="n">iTime</span><span class="p">,</span> <span class="n">iHeight</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

            <span class="c1"># if a 2nd dict is given, assume another dataset and plot on top</span>
            <span class="k">if</span> <span class="n">second_data_set</span><span class="p">:</span>
                <span class="c1"># find the closest spectra to the first device</span>
                <span class="n">iTime2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">time2</span><span class="p">,</span> <span class="n">time</span><span class="p">[</span><span class="n">iTime</span><span class="p">])</span>
                <span class="n">iHeight2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">height2</span><span class="p">,</span> <span class="n">rg</span><span class="p">)</span>

                <span class="n">dTime2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">time2</span><span class="p">[</span><span class="n">iTime2</span><span class="p">])</span>
                <span class="n">rg2</span> <span class="o">=</span> <span class="n">height2</span><span class="p">[</span><span class="n">iHeight2</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">annot</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span>
                            <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> UTC  at </span><span class="si">{:.2f}</span><span class="s1"> m (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dTime2</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">rg2</span><span class="p">,</span>
                                                              <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]),</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">smooth</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">vel2</span><span class="p">,</span> <span class="n">var2</span><span class="p">[</span><span class="n">iTime2</span><span class="p">,</span> <span class="n">iHeight2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">data2</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vel2</span><span class="p">,</span> <span class="n">var2</span><span class="p">[</span><span class="n">iTime2</span><span class="p">,</span> <span class="n">iHeight2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">data2</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;thresh&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">iTime</span><span class="p">,</span> <span class="n">iHeight</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">mean</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">lin2z</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">iTime</span><span class="p">,</span> <span class="n">iHeight</span><span class="p">])</span> <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">()</span> \
                        <span class="k">else</span> <span class="n">h</span><span class="o">.</span><span class="n">lin2z</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span>
                    <span class="n">legendtxt_mean</span> <span class="o">=</span> <span class="s1">&#39;mean noise floor =  </span><span class="si">{:.2f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">mean</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legendtxt_mean</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;thresh&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;thresh&#39;</span><span class="p">][</span><span class="n">iTime</span><span class="p">,</span> <span class="n">iHeight</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">thresh</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">lin2z</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;thresh&#39;</span><span class="p">][</span><span class="n">iTime</span><span class="p">,</span> <span class="n">iHeight</span><span class="p">])</span> <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;thresh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">()</span> \
                        <span class="k">else</span> <span class="n">h</span><span class="o">.</span><span class="n">lin2z</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;thresh&#39;</span><span class="p">])</span>
                    <span class="n">legendtxt_thresh</span> <span class="o">=</span> <span class="s1">&#39;noise floor threshold =  </span><span class="si">{:.2f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">thresh</span><span class="p">,</span> <span class="n">thresh</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legendtxt_thresh</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">velmin</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">velmax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Doppler Velocity [m s$^{-1}$]&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectivity [dBZ]&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">formatted_datetime</span> <span class="o">=</span> <span class="n">dTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> km&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">],</span> <span class="n">formatted_datetime</span><span class="p">,</span>
                                                        <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)),</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="c1"># ax.tick_params(axis=&#39;both&#39;, which=&#39;minor&#39;, labelsize=8)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">figure_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{:.0f}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ifig</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
                                                               <span class="n">dTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S_UTC&#39;</span><span class="p">),</span>
                                                               <span class="n">height</span><span class="p">[</span><span class="n">iHeight</span><span class="p">])</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figure_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Saved </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> png to  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ifig</span><span class="p">,</span> <span class="n">n_figs</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">))</span>

            <span class="n">ifig</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ifig</span> <span class="o">!=</span> <span class="n">n_figs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_spectrogram"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_spectrogram">[docs]</a><span class="k">def</span> <span class="nf">plot_spectrogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a time or height spectrogram</span>

<span class="sd">    The user is able to provide sliced containers, e.g.</span>

<span class="sd">    - range spectrogram: ``data[&#39;dimlabel&#39;] = [&#39;range&#39;, &#39;vel&#39;]``</span>
<span class="sd">    - time spectrogram: ``data[&#39;dimlabel&#39;] = [&#39;time, &#39;vel&#39;]``</span>
<span class="sd">    - time-range spectrogram: ``data[&#39;dimlabel&#39;] = [&#39;time, &#39;range&#39;, &#39;vel&#39;]``</span>

<span class="sd">    In the latter case, a height or time (value or index) must be provided</span>
<span class="sd">    at which the time / height spectrogram should be drawn</span>

<span class="sd">    Args:</span>
<span class="sd">        data: data container</span>
<span class="sd">        **index (dict): either {&#39;time&#39;: time index} or {&#39;range&#39;: range index}</span>
<span class="sd">        **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **fig_size (list): size of png, default is [10, 5.7]</span>
<span class="sd">        **v_lims (list): limits of Doppler velocity to be plotted</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - fig (pyplot figure): contains the figure of the plot</span>
<span class="sd">        - ax (pyplot axis): contains the axis of the plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Plotting parameters</span>
    <span class="n">fsz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">12</span>
    <span class="n">fwgt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;font_weight&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;font_weight&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;semibold&#39;</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>
    <span class="n">cbar_flag</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cbar&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;cbar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;custom colormaps </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">in</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="p">[</span><span class="n">colormap</span><span class="p">]</span>

    <span class="n">fraction_color_bar</span> <span class="o">=</span> <span class="mf">0.13</span>

    <span class="n">n_time</span><span class="p">,</span> <span class="n">n_height</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">reshape_spectra</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># depending on dimensions of given data, decide if height or time spectrogram should be plotted</span>
    <span class="c1"># (1) dimensions ar time and height, then a h or t must be given</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_height</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n_time</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;For time-height data container, you need to pass a time or height index to plot &quot;</span> \
                                  <span class="s2">&quot;the spectrogram, e.g. index={&#39;time&#39;:5}&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;range_spec&#39;</span> <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;time_spec&#39;</span> <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span> <span class="k">else</span> <span class="n">index</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span> <span class="k">else</span> <span class="n">time</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span> <span class="k">else</span> <span class="n">height</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span> <span class="k">else</span> <span class="n">var</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span> <span class="k">else</span> <span class="n">var</span>
    <span class="c1"># (2) only time dimension</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n_height</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n_time</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;range_spec&#39;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="c1"># (3) only height dimension</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n_height</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n_time</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;time_spec&#39;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># (4) only one spectrum, Error</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">n_height</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n_time</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Only one spectrum given.&#39;</span>
    <span class="k">assert</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Method not found. Check your index definition.&#39;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span><span class="p">:</span>
        <span class="n">x_var</span> <span class="o">=</span> <span class="n">vel</span>
        <span class="n">y_var</span> <span class="o">=</span> <span class="n">height</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span><span class="p">:</span>
        <span class="n">dt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">time</span><span class="p">)]</span>
        <span class="n">y_var</span> <span class="o">=</span> <span class="n">vel</span>
        <span class="c1"># identify time jumps &gt; 60 seconds (e.g. MIRA scans)</span>
        <span class="n">jumps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">time</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">jumps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
            <span class="c1"># start from the end or stuff will be inserted in the beginning and thus shift the index</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;masked jump at </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
            <span class="n">dt_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">var</span><span class="p">[:,</span> <span class="p">:])</span>
        <span class="n">x_var</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dt_list</span><span class="p">)</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">)</span>
    <span class="c1"># start plotting</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">pcmesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_var</span><span class="p">,</span> <span class="n">y_var</span><span class="p">,</span> <span class="n">var</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">cbar_flag</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bar_pad&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;bar_pad&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.025</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcmesh</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="n">fraction_color_bar</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;v_lims&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;v_lims&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;v_lims&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Velocity [m s$</span><span class="se">\\</span><span class="s1">mathregular{^{-1}}$]&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fwgt</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Height [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Velocity [m s$</span><span class="se">\\</span><span class="s1">mathregular{^{-1}}$]&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fwgt</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [UTC]&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fwgt</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>
        <span class="n">time_extend</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_set_xticks_and_xlabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">time_extend</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> spectrogram at </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y %H:%M:%S&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;range_spec&#39;</span>
                                                    <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">height</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]),</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin2z&#39;</span><span class="p">:</span>
                <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="s2">&quot;dB&quot;</span><span class="p">,</span>
                                                 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">z_string</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fwgt</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fsz</span><span class="p">)</span>

        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;major&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;time_spec&#39;</span><span class="p">:</span>
        <span class="n">time_extend</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;time extent </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_extend</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_set_xticks_and_xlabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">time_extend</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax</span><span class="p">,</span> <span class="n">pcmesh</span><span class="p">]</span></div>


<div class="viewcode-block" id="concat_images"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.concat_images">[docs]</a><span class="k">def</span> <span class="nf">concat_images</span><span class="p">(</span><span class="n">imga</span><span class="p">,</span> <span class="n">imgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combines two color image ndarrays side-by-side.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ha</span><span class="p">,</span> <span class="n">wa</span> <span class="o">=</span> <span class="n">imga</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">hb</span><span class="p">,</span> <span class="n">wb</span> <span class="o">=</span> <span class="n">imgb</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">max_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ha</span><span class="p">,</span> <span class="n">hb</span><span class="p">])</span>
    <span class="n">total_width</span> <span class="o">=</span> <span class="n">wa</span> <span class="o">+</span> <span class="n">wb</span>
    <span class="n">new_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">max_height</span><span class="p">,</span> <span class="n">total_width</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">new_img</span><span class="p">[:</span><span class="n">ha</span><span class="p">,</span> <span class="p">:</span><span class="n">wa</span><span class="p">]</span> <span class="o">=</span> <span class="n">imga</span>
    <span class="n">new_img</span><span class="p">[:</span><span class="n">hb</span><span class="p">,</span> <span class="n">wa</span><span class="p">:</span><span class="n">wa</span> <span class="o">+</span> <span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">imgb</span>
    <span class="k">return</span> <span class="n">new_img</span></div>


<div class="viewcode-block" id="concat_n_images"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.concat_n_images">[docs]</a><span class="k">def</span> <span class="nf">concat_n_images</span><span class="p">(</span><span class="n">image_path_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combines N color images from a list of image path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">image_path_list</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">img</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">concat_images</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="plot_ppi"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_ppi">[docs]</a><span class="k">def</span> <span class="nf">plot_ppi</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot a mira plan-position-indicator scan</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): data_container holding the variable of the scan (Z, v, ..)</span>
<span class="sd">        azimuth (dict): data_container with the azimuth data</span>
<span class="sd">        **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **elv (float): elevation other than 75 deg</span>
<span class="sd">        **fig_size (list): size of png, default is [10, 5.7]</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
    <span class="c1"># if no elevation angle is supplied, set it to 75 degrees</span>
    <span class="n">elv</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;elv&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;elv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">75</span>
    <span class="n">plotkwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">plotkwargs</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>
    <span class="c1"># spherical coordinates to kartesian</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>
    <span class="n">elv</span> <span class="o">=</span> <span class="n">elv</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="c1"># elevations = np.repeat(elv, len(ranges))</span>
    <span class="n">azimuths</span> <span class="o">=</span> <span class="n">azimuth</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="c1"># elevations = np.transpose(np.repeat(elevations[:,np.newaxis], len(azimuths), axis = 1))</span>
    <span class="n">azimuths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">azimuths</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ranges</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elv</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">azimuths</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ranges</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elv</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuths</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="o">**</span><span class="n">plotkwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Horizontal distance [km]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Horizontal distance [km]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">z_string</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_rhi"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_rhi">[docs]</a><span class="k">def</span> <span class="nf">plot_rhi</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">elv</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot a mira range-height-indicator scan</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): data_container holding the variable of the scan (Z, LDR, ..)</span>
<span class="sd">        elv (dict): data_container with the elevation data</span>
<span class="sd">        **z_converter (string): convert var before plotting use eg &#39;lin2z&#39;</span>
<span class="sd">        **var_converter (string): alternate name for the z_converter</span>
<span class="sd">        **fig_size (list): size of png, default is [10, 5.7]</span>
<span class="sd">        **title (str or bool)</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
    <span class="n">plotkwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s1">&#39;var_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var_converter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">plotkwargs</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>

    <span class="n">ranges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">elevations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">elv</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">h_distance</span> <span class="o">=</span> <span class="n">ranges</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elevations</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="n">v_distance</span> <span class="o">=</span> <span class="n">ranges</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elevations</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">v_distance</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">h_distance</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v_distance</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v_distance</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Horizontal range [km]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height [km]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">z_string</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>
                   <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">formatted_datetime</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span>
                         <span class="n">formatted_datetime</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<span class="k">def</span> <span class="nf">remsens_limrad_quicklooks</span><span class="p">(</span><span class="n">container_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogFormatter</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="n">tstart</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data...&#39;</span><span class="p">)</span>

    <span class="n">site_name</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>

    <span class="n">time_list</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">dt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_list</span><span class="p">]</span>
    <span class="n">dt_list_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;LWP&#39;</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">]]</span>

    <span class="k">if</span> <span class="s1">&#39;timespan&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timespan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;24h&#39;</span><span class="p">:</span>
        <span class="n">dt_lim_left</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dt_lim_right</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dt_lim_left</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dt_lim_right</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">range_list</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.e-3</span>  <span class="c1"># convert to km</span>
    <span class="n">ze</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">lin2z</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
    <span class="n">mdv</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;VEL&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
    <span class="n">sw</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ldr</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;ldr&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
    <span class="n">lwp</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;LWP&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;rr&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">plot_range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plot_range&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;plot_range&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">]</span>

    <span class="c1"># create figure</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

    <span class="c1"># reflectivity plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Radar reflectivity factor&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
               <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">ze</span><span class="p">,</span>
                          <span class="n">vmin</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">vmax</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;colormap&#39;</span><span class="p">])</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cax0</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dBZ&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... Ze&#39;</span><span class="p">)</span>

    <span class="c1"># mean doppler velocity plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Mean Doppler velocity&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">mdv</span><span class="p">,</span>
                          <span class="n">vmin</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;VEL&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">vmax</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;VEL&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;VEL&#39;</span><span class="p">][</span><span class="s1">&#39;colormap&#39;</span><span class="p">])</span>
    <span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... mdv&#39;</span><span class="p">)</span>

    <span class="c1"># spectral width plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Spectral width&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span>
                          <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                               <span class="n">vmax</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">][</span><span class="s1">&#39;colormap&#39;</span><span class="p">])</span>
    <span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">LogFormatter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelOnlyBase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... sw&#39;</span><span class="p">)</span>

    <span class="c1"># linear depolarisation ratio plot</span>
    <span class="n">colors1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">colors2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">178</span><span class="p">))</span>
    <span class="n">colors3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">colors1</span><span class="p">,</span> <span class="n">colors2</span><span class="p">,</span> <span class="n">colors3</span><span class="p">))</span>
    <span class="n">mymap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;my_colormap&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Linear depolarisation ratio&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
               <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">ldr</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mymap</span><span class="p">)</span>
    <span class="n">divider4</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">cax4</span> <span class="o">=</span> <span class="n">divider4</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... ldr&#39;</span><span class="p">)</span>

    <span class="c1"># liquid water path plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Liquid Water Path&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dt_list_2</span><span class="p">,</span> <span class="n">lwp</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">divider5</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">cax5</span> <span class="o">=</span> <span class="n">divider5</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cax5</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Liquid Water Path (g/$\mathregular{m^2}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dt_lim_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">dt_lim_right</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... lwp&#39;</span><span class="p">)</span>

    <span class="c1"># rain rate plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Rain rate&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
               <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">divider6</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">cax6</span> <span class="o">=</span> <span class="n">divider6</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cax6</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dt_list_2</span><span class="p">,</span> <span class="n">rr</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rain rate (mm/h)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dt_lim_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">dt_lim_right</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (UTC)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... rr&#39;</span><span class="p">)</span>

    <span class="c1"># duration of nc file for meteorological data calculation</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;SurfTemp&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">wind</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;SurfWS&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">275.13</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">275.13</span>
    <span class="n">t_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">275.13</span>
    <span class="n">wind_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span>
    <span class="n">precip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">time_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">)</span>

    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Meteor. Data: Avg. T.: </span><span class="si">{:.2f}</span><span class="s1"> °C;  Max. T.: </span><span class="si">{:.2f}</span><span class="s1"> °C;  Min. T.: </span><span class="si">{:.2f}</span><span class="s1"> °C;  &#39;</span> \
          <span class="s1">&#39;Mean wind: </span><span class="si">{:.2f}</span><span class="s1"> m/s;  Total precip.: </span><span class="si">{:.2f}</span><span class="s1"> mm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_avg</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">wind_avg</span><span class="p">,</span> <span class="n">precip</span><span class="p">)</span>

    <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">plot_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">,</span> <span class="n">plot_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># y-axis ticks</span>

    <span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (km)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dt_lim_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">dt_lim_right</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">plot_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">plot_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
    <span class="n">date_string</span> <span class="o">=</span> <span class="n">dt_lim_left</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> (UTC), </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">date_string</span><span class="p">,</span> <span class="n">site_name</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="c1"># place in title needs to be adjusted</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting done, elapsed time = </span><span class="si">{:.3f}</span><span class="s1"> sec.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tstart</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">remsens_limrad_polarimetry_quicklooks</span><span class="p">(</span><span class="n">container_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogFormatter</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="n">tstart</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data...&#39;</span><span class="p">)</span>

    <span class="n">site_name</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;paraminfo&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>

    <span class="n">time_list</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="n">dt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_list</span><span class="p">]</span>
    <span class="n">dt_list_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;LWP&#39;</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">]]</span>

    <span class="k">if</span> <span class="s1">&#39;timespan&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timespan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;24h&#39;</span><span class="p">:</span>
        <span class="n">dt_lim_left</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dt_lim_right</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dt_lim_left</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dt_lim_right</span> <span class="o">=</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">range_list</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.e-3</span>  <span class="c1"># convert to km</span>
    <span class="n">ze</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">lin2z</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ldr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;ldr&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.0</span><span class="p">)</span>
    <span class="n">zdr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;ZDR&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.0</span><span class="p">)</span>
    <span class="n">rhv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;RHV&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.0</span><span class="p">)</span>
    <span class="n">lwp</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;LWP&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;rr&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">hmax</span> <span class="o">=</span> <span class="mf">12.0</span>
    <span class="n">ticklen</span> <span class="o">=</span> <span class="mf">6.</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="n">cbar_ticklen</span> <span class="o">=</span> <span class="n">ticklen</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">cbar_pad</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="c1"># create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

    <span class="c1"># reflectivity plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Radar reflectivity factor&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
               <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">ze</span><span class="p">,</span>
                          <span class="n">vmin</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">vmax</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;colormap&#39;</span><span class="p">])</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cax0</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dBZ&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... Ze&#39;</span><span class="p">)</span>

    <span class="c1"># linear depolarisation ratio plot</span>
    <span class="n">colors1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">colors2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">178</span><span class="p">))</span>
    <span class="n">colors3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">colors1</span><span class="p">,</span> <span class="n">colors2</span><span class="p">,</span> <span class="n">colors3</span><span class="p">))</span>
    <span class="n">mymap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;my_colormap&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Linear depolarisation ratio&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
               <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">ldr</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mymap</span><span class="p">)</span>
    <span class="n">divider4</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cax4</span> <span class="o">=</span> <span class="n">divider4</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... ldr&#39;</span><span class="p">)</span>

    <span class="c1"># differential reflectivity plot</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Differential reflectivity&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">zdr</span><span class="p">,</span>
                          <span class="n">vmin</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;ZDR&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">vmax</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;ZDR&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;ZDR&#39;</span><span class="p">][</span><span class="s1">&#39;colormap&#39;</span><span class="p">],</span>
                          <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... ZDR&#39;</span><span class="p">)</span>

    <span class="c1"># correlation coefficient plot</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Correlation coefficient $</span><span class="se">\\</span><span class="s1">rho_</span><span class="si">{HV}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dt_list</span><span class="p">,</span> <span class="n">range_list</span><span class="p">,</span> <span class="n">rhv</span><span class="p">,</span>
                          <span class="n">vmin</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;RHV&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">vmax</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;RHV&#39;</span><span class="p">][</span><span class="s1">&#39;var_lims&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;RHV&#39;</span><span class="p">][</span><span class="s1">&#39;colormap&#39;</span><span class="p">],</span>
                          <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">divider3</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">cax3</span> <span class="o">=</span> <span class="n">divider3</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="n">cax3</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">cbar_ticklen</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">cbar_pad</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">ticklen</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... RHV&#39;</span><span class="p">)</span>

    <span class="c1"># liquid water path plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Liquid Water Path&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dt_list_2</span><span class="p">,</span> <span class="n">lwp</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">divider5</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">cax5</span> <span class="o">=</span> <span class="n">divider5</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cax5</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Liquid Water Path (g/$\mathregular{m^2}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dt_lim_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">dt_lim_right</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... lwp&#39;</span><span class="p">)</span>

    <span class="c1"># rain rate plot</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">015</span><span class="p">,</span> <span class="o">.</span><span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;Rain rate&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
               <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">))</span>
    <span class="n">divider6</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">cax6</span> <span class="o">=</span> <span class="n">divider6</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">cax6</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dt_list_2</span><span class="p">,</span> <span class="n">rr</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">dt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rain rate (mm/h)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dt_lim_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">dt_lim_right</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (UTC)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">AutoMinorLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting data... rr&#39;</span><span class="p">)</span>

    <span class="c1"># duration of nc file for meteorological data calculation</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;SurfTemp&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">wind</span> <span class="o">=</span> <span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;SurfWS&#39;</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">275.13</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">275.13</span>
    <span class="n">t_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">275.13</span>
    <span class="n">wind_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span>
    <span class="n">precip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">time_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">)</span>

    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Meteor. Data: Avg. T.: </span><span class="si">{:.2f}</span><span class="s1"> °C;  Max. T.: </span><span class="si">{:.2f}</span><span class="s1"> °C;  Min. T.: </span><span class="si">{:.2f}</span><span class="s1"> °C;  &#39;</span> \
          <span class="s1">&#39;Mean wind: </span><span class="si">{:.2f}</span><span class="s1"> m/s;  Total precip.: </span><span class="si">{:.2f}</span><span class="s1"> mm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_avg</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">wind_avg</span><span class="p">,</span> <span class="n">precip</span><span class="p">)</span>

    <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># y-axis ticks</span>

    <span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Height (km)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">dt_lim_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">dt_lim_right</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">hmax</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
    <span class="n">date_string</span> <span class="o">=</span> <span class="n">dt_lim_left</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># place in title needs to be adjusted</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> (UTC), </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">container_dict</span><span class="p">[</span><span class="s1">&#39;Ze&#39;</span><span class="p">][</span><span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="n">date_string</span><span class="p">,</span> <span class="n">site_name</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting done, elapsed time = </span><span class="si">{:.3f}</span><span class="s1"> sec.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tstart</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">plot_spectra_cwt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">scalesmatr</span><span class="p">,</span> <span class="n">iT</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iR</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scales&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;scales&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.00</span><span class="p">]</span>
    <span class="n">z_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;z_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="n">scalesmatr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">scalesmatr</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">x_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;x_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;y_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

    <span class="n">colormap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;colormap&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;cloudnet_jet&#39;</span>
    <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig_size&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;fig_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.625</span><span class="p">]</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;features&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;custom colormaps </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">colormap</span> <span class="ow">in</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="p">[</span><span class="n">colormap</span><span class="p">]</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span>

    <span class="n">time</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">reshape_spectra</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># convert from linear units to logarithic units</span>
    <span class="n">vhspec</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="c1"># plotkwargs[&#39;norm&#39;] = matplotlib.colors.LogNorm(vmin=vmin, vmax=vmax)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signal_limrad</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">vhspec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signal_limrad</span> <span class="o">=</span> <span class="n">vhspec</span>

    <span class="k">if</span> <span class="s1">&#39;mira_spec&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mira_spec&#39;</span><span class="p">]</span>
        <span class="n">vel2</span> <span class="o">=</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">time2</span><span class="p">,</span> <span class="n">height2</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">mask2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">reshape_spectra</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;z_converter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lin2z&#39;</span><span class="p">:</span>
            <span class="n">signal_mira</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_converter&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">var2</span><span class="p">)</span>
        <span class="n">second_data_set</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">second_data_set</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">cwtmatr_spec</span> <span class="o">=</span> <span class="n">scalesmatr</span>
    <span class="n">rg</span> <span class="o">=</span> <span class="n">height</span><span class="p">[</span><span class="n">iR</span><span class="p">]</span>

    <span class="c1"># plot spectra</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Doppler spectra, normalized and wavlet transformation</span><span class="se">\n</span><span class="s1">height: &#39;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">height</span><span class="p">[</span><span class="n">iR</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span>
                    <span class="s1">&#39; (m);  time: </span><span class="si">{}</span><span class="s1"> (UTC)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)),</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">signal_limrad</span><span class="p">[</span><span class="n">iT</span><span class="p">,</span> <span class="n">iR</span><span class="p">,</span> <span class="p">:],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.75</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LIMRAD94 Doppler spectrum&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Doppler</span><span class="se">\n</span><span class="s1">spectrum (dBZ)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="c1"># ax2 = divider0.append_axes(&quot;bottom&quot;, size=&quot;50%&quot;, pad=0.08)</span>

    <span class="n">dT</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>
    <span class="c1"># ax[0].text(0.01, 0.93, &#39;{} UTC  at {:.2f} m ({})&#39;.format(dT.strftime(&quot;%Y-%m-%d %H:%M:%S.%f&quot;)[:-3], rg, &#39;LIMRAD94&#39;),</span>
    <span class="c1">#           horizontalalignment=&#39;left&#39;, verticalalignment=&#39;center&#39;, transform=ax[0].transAxes)</span>

    <span class="k">if</span> <span class="s1">&#39;vspec_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vhspec_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vspec_norm&#39;</span><span class="p">]</span>
        <span class="n">ax11</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
        <span class="n">nds</span> <span class="o">=</span> <span class="n">ax11</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">vhspec_norm</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;normalized Doppler spectrum&#39;</span><span class="p">)</span>
        <span class="n">ax11</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax11</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax11</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;normalized</span><span class="se">\n</span><span class="s1">spectrum (-)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="c1"># ax11.grid()</span>

    <span class="k">if</span> <span class="n">second_data_set</span><span class="p">:</span>
        <span class="c1"># find the closest spectra to the first device</span>
        <span class="n">iT2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">time2</span><span class="p">,</span> <span class="n">time</span><span class="p">[</span><span class="n">iT</span><span class="p">])</span>
        <span class="n">iR2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">height2</span><span class="p">,</span> <span class="n">rg</span><span class="p">)</span>

        <span class="n">dT2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">time2</span><span class="p">[</span><span class="n">iT2</span><span class="p">])</span>
        <span class="n">rg2</span> <span class="o">=</span> <span class="n">height2</span><span class="p">[</span><span class="n">iR2</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">vel2</span><span class="p">,</span> <span class="n">signal_mira</span><span class="p">[</span><span class="n">iT2</span><span class="p">,</span> <span class="n">iR2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MIRA Doppler Spectrum&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span>
                   <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> UTC  at </span><span class="si">{:.2f}</span><span class="s1"> m (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dT2</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">rg2</span><span class="p">,</span> <span class="s1">&#39;MIRA&#39;</span><span class="p">),</span>
                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="n">divider0</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cax0</span> <span class="o">=</span> <span class="n">divider0</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2.5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">cax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="c1"># fig.add_axes(cax0)</span>

    <span class="c1"># added these three lines</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">lns</span> <span class="o">=</span> <span class="n">ds</span> <span class="o">+</span> <span class="n">nds</span> <span class="k">if</span> <span class="s1">&#39;vspec_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">ds</span>
        <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lns</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lns</span><span class="p">,</span> <span class="n">labs</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="c1"># plt.legend(loc=&#39;upper right&#39;)</span>
    <span class="n">ia</span><span class="p">,</span> <span class="n">ib</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">h</span><span class="o">.</span><span class="n">argnearest</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cwtmatr_spec</span><span class="p">[:,</span> <span class="n">ia</span><span class="p">:</span><span class="n">ib</span><span class="p">],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">widths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                       <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">z_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">z_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;wavelet</span><span class="se">\n</span><span class="s1">scale&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Doppler Velocity (m/s)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
    <span class="c1"># ax = plt.gca()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="c1"># Set the tick labels</span>
    <span class="c1"># ax[1].set_yticklabels([r&#39;$2^{1.75}$&#39;, r&#39;$2^{2.5}$&#39;, &#39;$2^{3.25}$&#39;, &#39;$2^{3.75}$&#39;])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2.5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Magnitude</span><span class="se">\n</span><span class="s1">of Similarity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="c1"># plt.rcParams[&#39;xtick.bottom&#39;] = plt.rcParams[&#39;xtick.labelbottom&#39;] = False</span>
    <span class="c1"># plt.rcParams[&#39;xtick.top&#39;] = plt.rcParams[&#39;xtick.labeltop&#39;] = True</span>

    <span class="c1"># plt.tight_layout(rect=[0, 0.01, 1, 1], h_pad=0.1)</span>
    <span class="c1"># plt.show()</span>

    <span class="k">if</span> <span class="s1">&#39;features&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="s1">&#39;four_colors&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">widths</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">four_colors_map</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="c1"># ax[2].set_ylabel(&#39;wavelet\nscale&#39;, fontweight=&#39;bold&#39;, fontsize=fontsize)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Doppler Velocity (m/s)&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
        <span class="c1"># ax = plt.gca()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="c1"># Set the tick labels</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$2^</span><span class="si">{1.00}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$2^</span><span class="si">{1.75}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$2^</span><span class="si">{2.50}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$2^</span><span class="si">{3.75}</span><span class="s1">$&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2.5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="s1">&#39;four_colors&#39;</span><span class="p">]</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">))))</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>


<div class="viewcode-block" id="container2DataArray"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.container2DataArray">[docs]</a><span class="k">def</span> <span class="nf">container2DataArray</span><span class="p">(</span><span class="n">container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convert the data_container to a xarray Dataset</span>
<span class="sd">    </span>
<span class="sd">    ``time`` dimension (named ``ts``) is converted to datatime.datetime and to datetime64</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): data_container</span>

<span class="sd">    Returns:</span>
<span class="sd">        ``xarray.DataArray``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

    <span class="n">dimlabel</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>

    <span class="c1"># the dimlabel is not always named exactly as the key of the dimension</span>
    <span class="c1">#</span>
    <span class="n">label2coord</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="s1">&#39;rg&#39;</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="s1">&#39;vel&#39;</span><span class="p">}</span>

    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">dimlabel</span><span class="p">:</span>
        <span class="n">container</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">ts_to_dt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]]</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">container</span><span class="p">[</span><span class="n">label2coord</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]]</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="c1"># strip off the actual arrays from the attrs</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">container</span><span class="p">}</span>
    <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mask&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">[</span><span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">label2coord</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]]</span>

    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">var</span><span class="p">,</span>
                      <span class="n">dims</span><span class="o">=</span><span class="n">dimlabel</span><span class="p">,</span>
                      <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                      <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>
                      <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">da</span></div>


<div class="viewcode-block" id="roll_mean_2D"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.roll_mean_2D">[docs]</a><span class="k">def</span> <span class="nf">roll_mean_2D</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">windowsize</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate a rolling mean over a given axis of a 2D (time x range) array</span>
<span class="sd">    Args:</span>
<span class="sd">        matrix (ndarray): 2D (time x range) matrix</span>
<span class="sd">        windowsize (int): size of the moving window</span>
<span class="sd">        dim (str): over which dimension to apply the mean, &#39;time&#39; or &#39;range&#39;</span>

<span class="sd">    Returns: 2D matrix of averaged values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="n">windowsize</span><span class="p">}</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">])</span>  <span class="c1"># turn matrix into data array to use xarray rolling function</span>
    <span class="n">da_roll</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">da_roll</span><span class="o">.</span><span class="n">values</span></div>


<span class="c1">#########################################################################</span>
<span class="c1">###### new module</span>


<span class="n">_DEFAULT_FIGSIZE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">]</span>


<div class="viewcode-block" id="_new_fig"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._new_fig">[docs]</a><span class="k">def</span> <span class="nf">_new_fig</span><span class="p">(</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figure</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens or parses a matplotlib figure and axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        figsize (optional): list of figure height and width</span>
<span class="sd">        figure (optional): already open matplotlib figure</span>
<span class="sd">        axis (optional): already open matplotlib axis</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **axis**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">_DEFAULT_FIGSIZE</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">figure</span> <span class="ow">and</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_copy_data"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._copy_data">[docs]</a><span class="k">def</span> <span class="nf">_copy_data</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
        <span class="n">colormp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rg_converter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">time_interval</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_interval</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">var_lims</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">labelsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
        <span class="n">cbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">clim</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy data from an xarray or larda dict to the plot data structure &#39;pdata&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: xarray or larda dict</span>
<span class="sd">        colormp (optional): string key from matplotlib colormaps</span>
<span class="sd">        mask (optional): additional variable mask (invalid/missing data)</span>
<span class="sd">        rg_converter (optional): if True converting from m to km for 2D plots</span>
<span class="sd">        time_interval (optional): restricts the xaxis for time series and 2D data</span>
<span class="sd">        range_interval (optional): restricts the yaxis for 2D data</span>
<span class="sd">        var_lims (optional): new data limits, default: var_lims of data</span>
<span class="sd">        fontsize (optional): figure font size</span>
<span class="sd">        labelsize (optional): colorbar label size</span>
<span class="sd">        figsize (optional): figure size list of height and width</span>
<span class="sd">        fontweight (optional): axis label font weight</span>
<span class="sd">        cbar (optional): if False, hides the colorbar from the plot</span>
<span class="sd">        cmap (optional): string according to matplotlib colormap lists</span>
<span class="sd">        linewidth (optional): width of time series data line plot</span>
<span class="sd">        alpha (optional): alpha of time series data line plot</span>

<span class="sd">    Returns:</span>
<span class="sd">        pdata (plot data structure)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pdata</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># check for availability of dimensions in larda container or xarray object</span>
    <span class="c1"># xarray</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;coords&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;rg&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;attribute error, check coords ... wrong plot function for </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">colormap</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;colormap&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">colormp</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,),</span> <span class="sa">f</span><span class="s1">&#39;wrong plot function for </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimlabel&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[s]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[s]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="s1">&#39;mask&#39;</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mask</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">system</span>
        <span class="k">if</span> <span class="n">var_lims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;var_lims&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No var_lims were provided!&#39;</span><span class="p">)</span>

                <span class="c1"># larda container</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;wrong plot function for </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimlabel&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;colormap&#39;</span><span class="p">]</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;wrong plot function for </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dimlabel&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var_lims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;var_lims&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No var_lims were provided!&#39;</span><span class="p">)</span>

    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]]</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">time_interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time_interval</span>

    <span class="k">if</span> <span class="n">rg_converter</span><span class="p">:</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>

    <span class="k">if</span> <span class="s1">&#39;range&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]:</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">range_interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">range_interval</span>

    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_FIGSIZE</span> <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">figsize</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labelsize</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontweight</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cbar</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
    <span class="k">return</span> <span class="n">pdata</span></div>


<div class="viewcode-block" id="_masked_jumps"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._masked_jumps">[docs]</a><span class="k">def</span> <span class="nf">_masked_jumps</span><span class="p">(</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">tdel_jumps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
        <span class="n">tres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fills data gaps with fill_values and masks them.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        tdel_jumps (optional): time jump threshold in seconds</span>
<span class="sd">        tres (optional): target time resolution in seconds</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with data corrected for gaps</span>

<span class="sd">        - **dt** (list): datetimes</span>
<span class="sd">        - **var** (np.ma.ndarray): var</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># this is the last valid index</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
    <span class="n">jumps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">tdel_jumps</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">filled_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">999</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="o">-</span><span class="mi">999</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">jumps</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;masked jump at </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">dt</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="c1"># and modify the dt_list</span>
        <span class="n">dt</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">tres</span><span class="p">))</span>
        <span class="c1"># add the fill array</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">filled_profile</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span><span class="p">)</span></div>


<div class="viewcode-block" id="_get_cbar_limits"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._get_cbar_limits">[docs]</a><span class="k">def</span> <span class="nf">_get_cbar_limits</span><span class="p">(</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">is_class</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">cbar_fraciton</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.13</span><span class="p">,</span>
        <span class="n">zlim</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the minimum and maximum value for the colorbar.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdata:</span>
<span class="sd">        is_class (optional): if True increas colorbar portion for larger labels</span>
<span class="sd">        cbar_fraciton (optional): colorbar fraction</span>
<span class="sd">        zlim (optional): if provided, these colorbar limits will get passed through</span>

<span class="sd">    Returns:</span>
<span class="sd">        zlim - color bar axis limits</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cbar_fraciton&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cbar_fraciton</span>
    <span class="k">if</span> <span class="n">is_class</span><span class="p">:</span>
        <span class="c1"># make the figure a littlebit wider and</span>
        <span class="c1"># center the label dashes in the middle of the individual color box</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cbar_fraciton&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.23</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]])</span> <span class="o">-</span> <span class="mf">0.5</span>

    <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;var_lims&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">zlim</span></div>


<div class="viewcode-block" id="_apply_2Dvar_converter"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._apply_2Dvar_converter">[docs]</a><span class="k">def</span> <span class="nf">_apply_2Dvar_converter</span><span class="p">(</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">var_converter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">z_converter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a 2D numpy array for a given valid string.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        pdata: </span>
<span class="sd">        var_converter (optional): other name for variable converter string</span>
<span class="sd">        z_converter (optional): variable converter string</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **var**: converted variable</span>
<span class="sd">        - **norm**: matplotlib log norm</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">var_converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z_converter</span> <span class="o">=</span> <span class="n">var_converter</span>

    <span class="k">if</span> <span class="n">z_converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">z_converter</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">z_converter</span><span class="p">)[</span><span class="mi">0</span><span class="p">](</span><span class="n">var</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="n">norm</span></div>


<div class="viewcode-block" id="_apply_1Dvar_converter"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._apply_1Dvar_converter">[docs]</a><span class="k">def</span> <span class="nf">_apply_1Dvar_converter</span><span class="p">(</span>
        <span class="n">var</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">var_converter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">z_converter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Converts a 1D numpy array for a given valid string.</span>

<span class="sd">    Args:</span>
<span class="sd">        var: 1D numpy array data</span>
<span class="sd">        var_converter (optional): other name for variable converter string</span>
<span class="sd">        z_converter (optional): variable converter string</span>

<span class="sd">    Returns:</span>
<span class="sd">        va - converted array</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">va</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">var_converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z_converter</span> <span class="o">=</span> <span class="n">var_converter</span>

    <span class="k">if</span> <span class="n">z_converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">z_converter</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">va</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">get_converter_array</span><span class="p">(</span><span class="n">z_converter</span><span class="p">)[</span><span class="mi">0</span><span class="p">](</span><span class="n">va</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">va</span></div>


<div class="viewcode-block" id="_apply_log_scaling"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._apply_log_scaling">[docs]</a><span class="k">def</span> <span class="nf">_apply_log_scaling</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">var_converter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">z_converter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Converts the yaxis scale to log iff z_converter = &#39;log&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        ax: matplotlib axis</span>
<span class="sd">        var_converter (optional): other name for variable converter string</span>
<span class="sd">        z_converter (optional): variable converter string</span>

<span class="sd">    Returns:</span>
<span class="sd">        va - converted array</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">var_converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z_converter</span> <span class="o">=</span> <span class="n">var_converter</span>
    <span class="k">if</span> <span class="n">z_converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">z_converter</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="_get_colormap"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._get_colormap">[docs]</a><span class="k">def</span> <span class="nf">_get_colormap</span><span class="p">(</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="ow">or</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parse colormap string or check for additional color maps.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdata: plot data</span>

<span class="sd">    Returns:</span>
<span class="sd">        cmap - colormap string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;custom colormaps </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">custom_colormaps</span><span class="p">[</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="_add_contour"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._add_contour">[docs]</a><span class="k">def</span> <span class="nf">_add_contour</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">contour</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rg_converter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Plots contour lines with label ontop of an existing matplotlib axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        contour (optional): dictionary with keys &#39;data&#39; and &#39;levels&#39; (optional), where data is an xarray or larda dict</span>
<span class="sd">        rg_converter (optional): if True convert range from meter to kilometer</span>
<span class="sd">        fontsize (optional): size of contour labels</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **ax**: axis</span>
<span class="sd">        - **pcont**:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pcont</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cdata</span> <span class="o">=</span> <span class="n">contour</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">cstyle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linestyles&#39;</span><span class="p">:</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">}</span>

        <span class="c1"># check for larda container or xarray</span>
        <span class="n">cdata_var</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">cdata</span><span class="o">.</span><span class="n">values</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cdata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Contour data empty!&#39;</span>
        <span class="n">cdata_rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">rg_converter</span> <span class="k">else</span> <span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>

        <span class="n">dt_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">cdata</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">in</span> <span class="n">contour</span><span class="p">:</span>
            <span class="n">pcont</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">dt_c</span><span class="p">,</span> <span class="n">cdata_rg</span><span class="p">,</span> <span class="n">cdata_var</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contour</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">cstyle</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pcont</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">dt_c</span><span class="p">,</span> <span class="n">cdata_rg</span><span class="p">,</span> <span class="n">cdata_var</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">cstyle</span><span class="p">)</span>

        <span class="n">axis</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">pcont</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f</span><span class="s1">°C&#39;</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pcont</span></div>


<div class="viewcode-block" id="_format_timexaxis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._format_timexaxis">[docs]</a><span class="k">def</span> <span class="nf">_format_timexaxis</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Zoom to a specific time interval and format xaxis.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata: plot structure data</span>

<span class="sd">    Returns:</span>
<span class="sd">        axis - plot axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">])</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [UTC]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_set_xticks_and_xlabels"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._set_xticks_and_xlabels">[docs]</a><span class="k">def</span> <span class="nf">_set_xticks_and_xlabels</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">time_extend</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function sets the ticks and labels of the x-axis (only when the x-axis is time in UTC).</span>

<span class="sd">    Options:</span>
<span class="sd">        -   time_extend &gt; 7 days:               major ticks every 2 day,  minor ticks every 12 hours</span>
<span class="sd">        -   7 days &gt; time_extend &gt; 2 days:      major ticks every day, minor ticks every  6 hours</span>
<span class="sd">        -   2 days &gt; time_extend &gt; 1 days:      major ticks every 12 hours, minor ticks every  3 hours</span>
<span class="sd">        -   1 days &gt; time_extend &gt; 6 hours:     major ticks every 3 hours, minor ticks every  30 minutes</span>
<span class="sd">        -   6 hours &gt; time_extend &gt; 1 hour:     major ticks every hour, minor ticks every  15 minutes</span>
<span class="sd">        -   else:                               major ticks every 15 minutes, minor ticks every  5 minutes</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: axis in which the x-ticks and labels have to be set</span>
<span class="sd">        time_extend: time difference of t_end - t_start (format datetime.timedelta)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax - axis with new ticks and labels</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DayLocator</span><span class="p">(</span><span class="n">bymonthday</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="se">\n</span><span class="s1">%H:%M&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">byminute</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">byminute</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">time_extend</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">byminute</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">byminute</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">byminute</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">byminute</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_format_rangeyaxis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._format_rangeyaxis">[docs]</a><span class="k">def</span> <span class="nf">_format_rangeyaxis</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">rg_converter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Zoom to a specific range interval and format yaxis.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata: plot structure data</span>
<span class="sd">        rg_converter: if True convert range from meter to kilometer</span>

<span class="sd">    Returns:</span>
<span class="sd">        axis - plot axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rg_converter</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">rg_unit</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">])</span>
        <span class="n">rg_unit</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg_unit&#39;</span><span class="p">]</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Height [</span><span class="si">{</span><span class="n">rg_unit</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_format_xaxis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._format_xaxis">[docs]</a><span class="k">def</span> <span class="nf">_format_xaxis</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;More general x axis formatting.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        fontsize (optional): size of labels</span>
<span class="sd">        fontweight (optional): weight of labels</span>
<span class="sd">        label: label for xaxis</span>

<span class="sd">    Returns:</span>
<span class="sd">        axis - plot axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s2">&quot;var_unit&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_format_yaxis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._format_yaxis">[docs]</a><span class="k">def</span> <span class="nf">_format_yaxis</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;More general y axis formatting.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        fontsize (optional): size of labels</span>
<span class="sd">        fontweight (optional): weight of labels</span>
<span class="sd">        label: label for xaxis</span>

<span class="sd">    Returns:</span>
<span class="sd">        axis - plot axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s2">&quot;var_unit&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_plot_line"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._plot_line">[docs]</a><span class="k">def</span> <span class="nf">_plot_line</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">label_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">step</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot a line or step</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        label_str: label of line</span>
<span class="sd">        step (bool or str): &#39;pre&#39;, &#39;mid&#39;, &#39;post&#39;, default False</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **ax**: plot axis</span>
<span class="sd">        - **line**: Line2D</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">][:]),</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][:],</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label_str</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">][:]),</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][:],</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label_str</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">step</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="n">line</span></div>



<div class="viewcode-block" id="_format_cbaraxis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._format_cbaraxis">[docs]</a><span class="k">def</span> <span class="nf">_format_cbaraxis</span><span class="p">(</span>
        <span class="n">figure</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pcmesh</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">color_by</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_scatter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">is_class</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">remove</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">clim</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Formates the colorbar.</span>

<span class="sd">    Args:</span>
<span class="sd">        figure: plot figure</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pcmesh: colormesh plot</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        color_by (optional): larda container</span>
<span class="sd">        is_scatter (optional): if True adapt colorbar for scatter plot</span>
<span class="sd">        is_class (optional): if True adapt colorbar with discrete labels</span>
<span class="sd">        remove (optional): if True remove colorbar</span>
<span class="sd">        clim (optional): colorbar limits</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **ax**: plot axis</span>
<span class="sd">        - **cbar**: colorbar</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">is_scatter</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">color_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;median </span><span class="si">{</span><span class="n">color_by</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">color_by</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="n">formstring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">z_string</span> <span class="o">=</span> <span class="s2">&quot;frequency of occurrence&quot;</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">formstring</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2E</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">formstring</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span>

        <span class="n">cbar</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcmesh</span><span class="p">,</span> <span class="n">use_gridspec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">extendrect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extendfrac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">formstring</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">z_string</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">clim</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">remove</span><span class="p">:</span>

        <span class="n">cbar</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcmesh</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;cbar_fraciton&#39;</span><span class="p">],</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">_axis_label_from_meta</span><span class="p">(</span><span class="n">pdata</span><span class="p">),</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_class</span><span class="p">:</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="n">VIS_Colormaps</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;colormap_name&#39;</span><span class="p">]]</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">))))</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">])</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">1.25</span>  <span class="c1"># change back to original</span>

        <span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span>
    <span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="_axis_label_from_meta"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._axis_label_from_meta">[docs]</a><span class="k">def</span> <span class="nf">_axis_label_from_meta</span><span class="p">(</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Generates an automated axis label from data</span>
<span class="sd">    using system name, variable name and variable unit.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdata: plot data structure</span>

<span class="sd">    Returns:</span>
<span class="sd">        str - axis label</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var_unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span></div>


<div class="viewcode-block" id="_format_axis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._format_axis">[docs]</a><span class="k">def</span> <span class="nf">_format_axis</span><span class="p">(</span>
        <span class="n">figure</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pcmesh</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">pdatai</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color_by</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format all axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        figure: plot figure</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pcmesh: colormesh plot</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        pdatai (optional): additional plot data structure, formatting scatter plots</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **ax**: axis</span>
<span class="sd">        - **cbar**: colorbar</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">AutoMinorLocator</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_format_timexaxis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time extend </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_set_xticks_and_xlabels</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;time_interval&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_class_or_status</span> <span class="o">=</span> <span class="s1">&#39;class&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_format_rangeyaxis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;range extend </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;range_interval&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">_format_cbaraxis</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pcmesh</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">is_class</span><span class="o">=</span><span class="n">is_class_or_status</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_format_yaxis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">)</span>

    <span class="c1"># second dataset for scatter plot yaxis</span>
    <span class="k">if</span> <span class="n">pdatai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_format_xaxis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_axis_label_from_meta</span><span class="p">(</span><span class="n">pdata</span><span class="p">))</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_format_yaxis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdatai</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_axis_label_from_meta</span><span class="p">(</span><span class="n">pdatai</span><span class="p">))</span>
        <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">_format_cbaraxis</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pcmesh</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">is_scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">],</span> <span class="n">color_by</span><span class="o">=</span><span class="n">color_by</span><span class="p">)</span>

    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span></div>


<div class="viewcode-block" id="_set_title"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._set_title">[docs]</a><span class="k">def</span> <span class="nf">_set_title</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Set/remove or auto generate a title.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        title (optional): title string</span>
<span class="sd">        **title_loc (optional): where to position title (&#39;center&#39;, &#39;left&#39;, &#39;right&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        axis - plot axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title_loc&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;title_loc&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;center&#39;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axis</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">title</span><span class="p">:</span>
        <span class="c1"># auto generated title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M</span><span class="si">}</span><span class="s2"> till </span><span class="si">{</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">%Y-%m-%d %H:%M</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="_get_line_label"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._get_line_label">[docs]</a><span class="k">def</span> <span class="nf">_get_line_label</span><span class="p">(</span>
        <span class="n">pdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span> <span class="ow">or</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parse or auto generate a line label.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdata: plot data structure</span>
<span class="sd">        label (optional): label name if string or autogenerated label if True, else no label</span>

<span class="sd">    Returns:</span>
<span class="sd">        string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">label</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="_Freedman_Diaconis"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._Freedman_Diaconis">[docs]</a><span class="k">def</span> <span class="nf">_Freedman_Diaconis</span><span class="p">(</span>
        <span class="n">var</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;unknown variable&#39;</span><span class="p">,</span>
        <span class="n">Nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse or calculate the optimum number of bins for a scatter plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        var: array</span>
<span class="sd">        name: variable name</span>
<span class="sd">        Nbins (optional): given number of bins</span>

<span class="sd">    Returns:</span>
<span class="sd">        Nbins - number of bins</span>

<span class="sd">    References:</span>
<span class="sd">        Freedman-Diaconis rule: h=2×IQR×n−1/3. number of bins is (max−min)/h, where n is the number of observations</span>
<span class="sd">        https://stats.stackexchange.com/questions/798/calculating-optimal-number-of-bins-in-a-histogram</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Nbins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Nbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var</span><span class="p">))</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;var </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: len is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">, &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;IQR is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanquantile</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span><span class="si">}</span><span class="s1">,&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;max is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">, min is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">Nbins</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">Nbins</span></div>


<div class="viewcode-block" id="_create_histogram"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._create_histogram">[docs]</a><span class="k">def</span> <span class="nf">_create_histogram</span><span class="p">(</span>
        <span class="n">var1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">var2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">Nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">x_lim</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_lim</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculates a histogram from two given arrays with same size</span>

<span class="sd">    Args:</span>
<span class="sd">        var1: array xdata</span>
<span class="sd">        var2: array ydata</span>
<span class="sd">        Nbins (optional): number of bin in histogram</span>
<span class="sd">        x_lim (optional): x axis limit</span>
<span class="sd">        y_lim (optional): y axis limit</span>

<span class="sd">    Returns:</span>
<span class="sd">        hist - dictionary with histogram, x and y edges</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">var1</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">var2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Provide two dataset sith same size!&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_lim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var1</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">y_lim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">var2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">var2</span><span class="p">)]</span>

    <span class="c1"># create histogram plot</span>
    <span class="n">hist</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">x_lim</span><span class="p">,</span> <span class="n">y_lim</span><span class="p">])</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="n">hist</span><span class="p">,</span> <span class="s1">&#39;xedges&#39;</span><span class="p">:</span> <span class="n">xedges</span><span class="p">,</span> <span class="s1">&#39;yedges&#39;</span><span class="p">:</span> <span class="n">yedges</span><span class="p">}</span></div>


<div class="viewcode-block" id="_color_by_3rd_variable"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._color_by_3rd_variable">[docs]</a><span class="k">def</span> <span class="nf">_color_by_3rd_variable</span><span class="p">(</span>
        <span class="n">var1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">var2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">var3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">H</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">Nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Recalculates a given histogram for a given 3rd variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        var1: array xdata</span>
<span class="sd">        var2: array ydata</span>
<span class="sd">        var3: array zdata</span>
<span class="sd">        H: given histogram dict keys = H, xedges, yedges</span>
<span class="sd">        Nbins: number of bin in histogram</span>

<span class="sd">    Returns:</span>
<span class="sd">        hist - new histogram array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># overwrite H</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># get the bins of the 2d histogram using digitize</span>
    <span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">H</span><span class="p">[</span><span class="s1">&#39;xedges&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">H</span><span class="p">[</span><span class="s1">&#39;yedges&#39;</span><span class="p">])</span>

    <span class="c1"># find unique bin combinations = pixels in scatter plot</span>
    <span class="c1"># sort x and y coordinates using lexsort</span>
    <span class="c1"># lexsort sorts by multiple columns, first by y_coords then by x_coords</span>
    <span class="n">newer_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">))</span>
    <span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">var3</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="n">newer_order</span><span class="p">],</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">newer_order</span><span class="p">],</span> <span class="n">var3</span><span class="p">[</span><span class="n">newer_order</span><span class="p">]</span>
    <span class="n">first_hit_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">y_coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbins</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">first_hit_y</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">first_hit_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x_coords</span><span class="p">[</span><span class="n">first_hit_y</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span><span class="n">first_hit_y</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nbins</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
                   <span class="o">+</span> <span class="n">first_hit_y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nbins</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nbins</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nbins</span><span class="p">):</span>
            <span class="n">hist</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">var3</span><span class="p">[</span><span class="n">first_hit_x</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]:</span> <span class="n">first_hit_x</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">hist</span></div>


<div class="viewcode-block" id="_get_pcmesh_kwargs"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._get_pcmesh_kwargs">[docs]</a><span class="k">def</span> <span class="nf">_get_pcmesh_kwargs</span><span class="p">(</span>
        <span class="n">H</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">clim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns a dict with vmin, vmax and norm for pcolormesh plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        H: histogram</span>
<span class="sd">        clim: given limits</span>
<span class="sd">        scale: scaling strategy</span>
<span class="sd">        cmap: colormap</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict - pcmesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">clim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">H</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="n">clim</span>

    <span class="n">pcmesh_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span><span class="p">:</span>
        <span class="n">pcmesh_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pcmesh_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0e12</span><span class="p">,</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])})</span>
        <span class="n">pcmesh_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="o">**</span><span class="n">pcmesh_kwargs</span><span class="p">)})</span>

    <span class="n">pcmesh_kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>

    <span class="k">return</span> <span class="n">pcmesh_kwargs</span></div>


<div class="viewcode-block" id="_add_regression_info"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations._add_regression_info">[docs]</a><span class="k">def</span> <span class="nf">_add_regression_info</span><span class="p">(</span>
        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span>
        <span class="n">pdata1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">pdata2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Add textbox with y axis intersetion, slope and r^2.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis: plot axis</span>
<span class="sd">        pdata1: plot data structure</span>
<span class="sd">        pdata2: plot data structure</span>
<span class="sd">        info:</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax - plot axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">])</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;slope = </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s1">5.3f</span><span class="si">}</span><span class="se">\n</span><span class="s1">intercept = </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">5.3f</span><span class="si">}</span><span class="se">\n</span><span class="s1">R^2 = </span><span class="si">{</span><span class="n">r</span> <span class="o">*</span> <span class="n">r</span><span class="si">:</span><span class="s1">5.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;fontweight&#39;</span><span class="p">],</span>
                <span class="n">labelsize</span><span class="o">=</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="plot_timeheight2"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_timeheight2">[docs]</a><span class="k">def</span> <span class="nf">plot_timeheight2</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a timeheight larda container or xarray Dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        data: data container</span>
<span class="sd">        **fig (optional): already open matplotlib figure</span>
<span class="sd">        **ax (optional): already open matplotlib axis</span>
<span class="sd">        **colormp (optional): string key from matplotlib colormaps</span>
<span class="sd">        **mask (optional): additional variable mask (invalid/missing data)</span>
<span class="sd">        **rg_converter (optional): if True converting from m to km for 2D plots</span>
<span class="sd">        **time_interval (optional): restricts the xaxis for time series and 2D data</span>
<span class="sd">        **range_interval (optional): restricts the yaxis for 2D data</span>
<span class="sd">        **var_lims (optional): new data limits, default: var_lims of data</span>
<span class="sd">        **fontsize (optional): figure font size</span>
<span class="sd">        **labelsize (optional): colorbar label size</span>
<span class="sd">        **fontweight (optional): axis label font weight</span>
<span class="sd">        **cbar (optional): if False, hides the colorbar from the plot</span>
<span class="sd">        **linewidth (optional): width of time series data line plot</span>
<span class="sd">        **alpha (optional): alpha of time series data line plot</span>
<span class="sd">        **zlim (optional): if provided, these colorbar limits will get passed through</span>
<span class="sd">        **var_converter (optional): other name for variable converter string</span>
<span class="sd">        **z_converter (optional): variable converter string</span>
<span class="sd">        **contour (optional): dictionary with keys &#39;data&#39; and &#39;levels&#39; (optional), where data is an xarray or larda dict</span>
<span class="sd">        **label (optional): label name if string or autogenerated label if True, else no label</span>
<span class="sd">        **clim (optional): colorbar limits</span>
<span class="sd">        **title (optional): title string</span>
<span class="sd">        **title_loc (optional): location string for title (&#39;center&#39;, &#39;left&#39;, &#39;right&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pdata</span> <span class="o">=</span> <span class="n">_copy_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_masked_jumps</span><span class="p">(</span><span class="n">pdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># add space for class or detection status labels</span>
    <span class="n">is_classification</span> <span class="o">=</span> <span class="s1">&#39;class&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_classification</span><span class="p">:</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.25</span>

    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_cbar_limits</span><span class="p">(</span><span class="n">pdata</span><span class="p">,</span> <span class="n">is_class</span><span class="o">=</span><span class="n">is_classification</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_apply_2Dvar_converter</span><span class="p">(</span><span class="n">pdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">cmap_labels</span> <span class="o">=</span> <span class="n">_get_colormap</span><span class="p">(</span><span class="n">pdata</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vlims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vlims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]}</span>

    <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">_new_fig</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
    <span class="n">pcmesh</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">pcolorfast</span><span class="p">(</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]),</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">],</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_labels</span><span class="p">,</span>
        <span class="o">**</span><span class="n">vlims</span>
    <span class="p">)</span>

    <span class="n">axis</span><span class="p">,</span> <span class="n">cont</span> <span class="o">=</span> <span class="n">_add_contour</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">_format_axis</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pcmesh</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">is_class</span><span class="o">=</span><span class="n">is_classification</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">_set_title</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="plot_timeseries2"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_timeseries2">[docs]</a><span class="k">def</span> <span class="nf">plot_timeseries2</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a timeseries data container or xarray dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: data container</span>
<span class="sd">        **fig (optional): already open matplotlib figure</span>
<span class="sd">        **ax (optional): already open matplotlib axis</span>
<span class="sd">        **colormp (optional): string key from matplotlib colormaps</span>
<span class="sd">        **mask (optional): additional variable mask (invalid/missing data)</span>
<span class="sd">        **time_interval (optional): restricts the xaxis for time series and 2D data</span>
<span class="sd">        **var_lims (optional): new data limits, default: var_lims of data</span>
<span class="sd">        **figsize (optional): size of the figure in inches</span>
<span class="sd">        **fontsize (optional): figure font size</span>
<span class="sd">        **labelsize (optional): colorbar label size</span>
<span class="sd">        **fontweight (optional): axis label font weight</span>
<span class="sd">        **cbar (optional): if False, hides the colorbar from the plot</span>
<span class="sd">        **linewidth (optional): width of time series data line plot</span>
<span class="sd">        **alpha (optional): alpha of time series data line plot</span>
<span class="sd">        **zlim (optional): if provided, these colorbar limits will get passed through</span>
<span class="sd">        **var_converter (optional): other name for variable converter string</span>
<span class="sd">        **z_converter (optional): variable converter string</span>
<span class="sd">        **contour (optional): dictionary with keys &#39;data&#39; and &#39;levels&#39; (optional), where data is an xarray or larda dict</span>
<span class="sd">        **label (optional): label name if string or autogenerated label if True, else no label</span>
<span class="sd">        **clim (optional): colorbar limits</span>
<span class="sd">        **title (optional): title string</span>
<span class="sd">        **title_loc (optional): location string for title (&#39;center&#39;, &#39;left&#39;, &#39;right&#39;)</span>
<span class="sd">        **x_lim (optional): x axis limit</span>
<span class="sd">        **y_lim (optional): y axis limit</span>


<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pdata</span> <span class="o">=</span> <span class="n">_copy_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">],</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_masked_jumps</span><span class="p">(</span><span class="n">pdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_apply_1Dvar_converter</span><span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">label_str</span> <span class="o">=</span> <span class="n">_get_line_label</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">pdata</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">_new_fig</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># otherwise _apply_log_scaling will get multiple values for argument &#39;ax&#39;</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;ax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span> 
    <span class="c1"># _format_axis() will get  multiple values for argument &#39;fig&#39;</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">axis</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">_plot_line</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="n">label_str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">axis</span> <span class="o">=</span> <span class="n">_apply_log_scaling</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_format_axis</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">_set_title</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="plot_scatter2"><a class="viewcode-back" href="../../datacontainer_and_transformation.html#pyLARDA.Transformations.plot_scatter2">[docs]</a><span class="k">def</span> <span class="nf">plot_scatter2</span><span class="p">(</span>
        <span class="n">data1</span><span class="p">:</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
        <span class="n">data2</span><span class="p">:</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
        <span class="n">identity_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color_by</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lin&#39;</span><span class="p">,</span>
        <span class="n">Nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot for variable comparison between two devices or variables.</span>

<span class="sd">    Args:</span>
<span class="sd">        data1: container 1st device</span>
<span class="sd">        data2: container 2nd device</span>
<span class="sd">        identity_line (optional): plot 1:1 line if True</span>
<span class="sd">        figsize (optional): size of the figure in inches</span>
<span class="sd">        color_by (optional): data container 3rd device</span>
<span class="sd">        scale (optional): &#39;lin&#39; or &#39;log&#39; --&gt; if you get a ValueError from matplotlib.colors</span>
<span class="sd">                          try setting scale to lin, log does not work for negative values!</span>
<span class="sd">        Nbins (optional): number of bins for histogram</span>
<span class="sd">        **fig (optional): already open matplotlib figure</span>
<span class="sd">        **ax (optional): already open matplotlib axis</span>
<span class="sd">        **colormp (optional): string key from matplotlib colormaps</span>
<span class="sd">        **mask (optional): additional variable mask (invalid/missing data)</span>
<span class="sd">        **var_lims (optional): new data limits, default: var_lims of data</span>
<span class="sd">        **fontsize (optional): figure font size</span>
<span class="sd">        **labelsize (optional): colorbar label size</span>
<span class="sd">        **fontweight (optional): axis label font weight</span>
<span class="sd">        **cbar (optional): if False, hides the colorbar from the plot</span>
<span class="sd">        **linewidth (optional): width of time series data line plot</span>
<span class="sd">        **alpha (optional): alpha of time series data line plot</span>
<span class="sd">        **zlim (optional): if provided, these colorbar limits will get passed through</span>
<span class="sd">        **var_converter (optional): other name for variable converter string</span>
<span class="sd">        **z_converter (optional): variable converter string</span>
<span class="sd">        **contour (optional): dictionary with keys &#39;data&#39; and &#39;levels&#39; (optional), where data is an xarray or larda dict</span>
<span class="sd">        **label (optional): label name if string or autogenerated label if True, else no label</span>
<span class="sd">        **clim (optional): colorbar limits</span>
<span class="sd">        **title (optional): title string</span>
<span class="sd">        **title_loc (optional): location string for title (&#39;center&#39;, &#39;left&#39;, &#39;right&#39;)</span>
<span class="sd">        **x_lim (optional): x axis limit</span>
<span class="sd">        **y_lim (optional): y axis limit</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple with</span>

<span class="sd">        - **fig**: matplotlib figure</span>
<span class="sd">        - **ax**: axis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_compare_grids</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">==</span> <span class="n">data2</span><span class="p">[</span><span class="n">var</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">same_grid</span> <span class="o">=</span> <span class="n">_compare_grids</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="s1">&#39;ts&#39;</span><span class="p">)</span>
    <span class="n">same_grid</span> <span class="o">*=</span> <span class="n">_compare_grids</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="s1">&#39;rg&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">same_grid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Provided dataset not on same grid!&#39;</span><span class="p">)</span>

    <span class="n">pdata1</span> <span class="o">=</span> <span class="n">_copy_data</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
    <span class="n">pdata2</span> <span class="o">=</span> <span class="n">_copy_data</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
    <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;dimlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;var_name&#39;</span><span class="p">]</span>

    <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span>
    <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_apply_1Dvar_converter</span><span class="p">(</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_apply_1Dvar_converter</span><span class="p">(</span><span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">Nbins</span> <span class="o">=</span> <span class="n">_Freedman_Diaconis</span><span class="p">(</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">Nbins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">_create_histogram</span><span class="p">(</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">Nbins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">color_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coloring scatter plot by </span><span class="si">{}</span><span class="s2">...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color_by</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
        <span class="n">var3</span> <span class="o">=</span> <span class="n">color_by</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">combined_mask</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color_by</span><span class="p">[</span><span class="s1">&#39;var_lims&#39;</span><span class="p">]</span>
        <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_color_by_3rd_variable</span><span class="p">(</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">var3</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">Nbins</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;xedges&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;yedges&#39;</span><span class="p">])</span>
    <span class="n">pcmesh_kwargs</span> <span class="o">=</span> <span class="n">_get_pcmesh_kwargs</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">clim</span><span class="o">=</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
    <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;clim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcmesh_kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">pcmesh_kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]]</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">figsize</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;cbar&#39;</span><span class="p">]:</span>
        <span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">_new_fig</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pcmesh</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]),</span> <span class="o">**</span><span class="n">pcmesh_kwargs</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">_add_regression_info</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata1</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">pdata2</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># helper lines (1:1), ...</span>
    <span class="k">if</span> <span class="n">identity_line</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_add_identity</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">_apply_log_scaling</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">axis</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">_format_axis</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pcmesh</span><span class="p">,</span> <span class="n">pdata1</span><span class="p">,</span> <span class="n">pdata2</span><span class="p">,</span> <span class="n">color_by</span><span class="o">=</span><span class="n">color_by</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">_set_title</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pdata1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figure</span><span class="p">,</span> <span class="n">axis</span></div>

<span class="c1">#########################</span>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020 pyLARDA-dev-team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>